{"version":3,"sources":["webpack:///./src/views/msg.vue?fb54","webpack:///./src/service/msg.js","webpack:///src/views/msg.vue","webpack:///./src/views/msg.vue?e760","webpack:///./src/views/msg.vue","webpack:///./src/views/msg.vue?fb80"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_m","attrs","unread_total","on","$event","read","domProps","_s","nativeOn","type","indexOf","_k","keyCode","key","changePage","model","value","callback","$$v","keyword","expression","slot","_v","data","_l","item","i","directives","name","rawName","deleted","class","content","hasLink","_f","_e","dateFormat","created","del","page","total","staticRenderFns","getMsgs","params","$helper","get","qs","stringify","readMsg","ids","put","removeMsg","props","methods","where","then","title","filters","msgLink","Base64","mounted","component"],"mappings":"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","file":"js/chunk-69981422.f9a2d96c.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"m-dashboard m-dashboard-work m-dashboard-msg\"},[_c('div',{staticClass:\"m-dashboard-msg-header\"},[_vm._m(0),_c('el-button',{staticClass:\"u-read-all\",attrs:{\"type\":\"primary\",\"size\":\"mini\",\"disabled\":!_vm.unread_total},on:{\"click\":function($event){return _vm.read(null)}}},[_c('i',{staticClass:\"el-icon el-icon-check\"}),_c('span',{domProps:{\"textContent\":_vm._s('全部设为已读')}})])],1),_c('el-input',{staticClass:\"m-dashboard-work-search\",attrs:{\"placeholder\":\"请输入搜索内容\"},nativeOn:{\"keyup\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\")){ return null; }return _vm.changePage(1)}},model:{value:(_vm.keyword),callback:function ($$v) {_vm.keyword=$$v},expression:\"keyword\"}},[_c('template',{slot:\"prepend\"},[_vm._v(\"关键词\")]),_c('el-button',{attrs:{\"slot\":\"append\",\"icon\":\"el-icon-search\"},on:{\"click\":function($event){return _vm.changePage(1)}},slot:\"append\"})],2),(_vm.data.length)?_c('ul',{staticClass:\"m-dashboard-box-list\"},_vm._l((_vm.data),function(item,i){return _c('li',{directives:[{name:\"show\",rawName:\"v-show\",value:(item.deleted == 0),expression:\"item.deleted == 0\"}],key:i,class:{ on: item.read == 1 }},[_c('div',{staticClass:\"u-primary\"},[_c('span',{staticClass:\"u-content\"},[(item.read == 1)?_c('span',{staticClass:\"u-label u-hasChecked\"},[_vm._v(\"已读\")]):_c('span',{staticClass:\"u-label u-hasNotChecked\"},[_vm._v(\"未读\")]),_c('span',{domProps:{\"innerHTML\":_vm._s(item.content)}}),(_vm.hasLink(item))?_c('a',{staticClass:\"u-msg-link\",attrs:{\"href\":_vm._f(\"msgLink\")(item),\"target\":\"_blank\"},on:{\"click\":function($event){return _vm.read(item)}}},[_c('i',{staticClass:\"el-icon-link\"}),_vm._v(\" 点击查看 \")]):_vm._e()]),_c('time',{staticClass:\"u-time\"},[_c('i',{staticClass:\"el-icon-phone-outline\"}),_vm._v(\" \"+_vm._s(_vm.dateFormat(~~item.created))+\" \")])]),_c('el-button-group',{staticClass:\"u-action\"},[_c('el-button',{attrs:{\"size\":\"mini\",\"icon\":\"el-icon-check\",\"title\":\"设为已读\",\"disabled\":item.read == 1},on:{\"click\":function($event){return _vm.read(item)}}}),_c('el-button',{attrs:{\"size\":\"mini\",\"icon\":\"el-icon-delete\",\"title\":\"删除\"},on:{\"click\":function($event){return _vm.del(item)}}})],1)],1)}),0):_c('el-alert',{staticClass:\"m-dashboard-box-null\",attrs:{\"title\":\"没有找到相关条目\",\"type\":\"info\",\"center\":\"\",\"show-icon\":\"\"}}),_c('el-pagination',{staticClass:\"m-dashboard-box-pages\",attrs:{\"background\":\"\",\"hide-on-single-page\":true,\"current-page\":_vm.page,\"layout\":\"total, prev, pager, next, jumper\",\"total\":_vm.total},on:{\"current-change\":_vm.changePage}})],1)}\nvar staticRenderFns = [function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('h2',{staticClass:\"u-title\"},[_c('i',{staticClass:\"el-icon-bell\"}),_vm._v(\" 我的消息 \")])}]\n\nexport { render, staticRenderFns }","import { $helper } from \"@jx3box/jx3box-common/js/https\";\nimport qs from \"qs\";\n\nfunction getMsgs(params) {\n    return $helper().get(`/api/messages?${qs.stringify(params)}`);\n}\n\nfunction readMsg(ids) {\n    let data = {};\n    if (ids) data.ids = ids;\n\n    return $helper().put(`/api/messages/read`, qs.stringify(data));\n}\n\nfunction removeMsg(ids) {\n    return $helper().put(\n        `/api/messages/remove`,\n        qs.stringify({\n            ids: ids,\n        })\n    );\n}\n\nexport { getMsgs, readMsg, removeMsg };\n","<template>\n    <div class=\"m-dashboard m-dashboard-work m-dashboard-msg\">\n        <div class=\"m-dashboard-msg-header\">\n            <h2 class=\"u-title\">\n                <i class=\"el-icon-bell\"></i> 我的消息\n            </h2>\n            <el-button\n                class=\"u-read-all\"\n                type=\"primary\"\n                size=\"mini\"\n                @click=\"read(null)\"\n                :disabled=\"!unread_total\"\n            >\n                <i class=\"el-icon el-icon-check\"></i>\n                <span v-text=\"'全部设为已读'\"></span>\n            </el-button>\n        </div>\n        <el-input\n            class=\"m-dashboard-work-search\"\n            placeholder=\"请输入搜索内容\"\n            v-model=\"keyword\"\n            @keyup.enter.native=\"changePage(1)\"\n        >\n            <template slot=\"prepend\">关键词</template>\n            <el-button slot=\"append\" icon=\"el-icon-search\" @click=\"changePage(1)\"></el-button>\n        </el-input>\n        <ul class=\"m-dashboard-box-list\" v-if=\"data.length\">\n            <li\n                v-for=\"(item, i) in data\"\n                :key=\"i\"\n                :class=\"{ on: item.read == 1 }\"\n                v-show=\"item.deleted == 0\"\n            >\n                <div class=\"u-primary\">\n                    <span class=\"u-content\">\n                        <span class=\"u-label u-hasChecked\" v-if=\"item.read == 1\">已读</span>\n                        <span class=\"u-label u-hasNotChecked\" v-else>未读</span>\n                        <span v-html=\"item.content\"></span>\n                        <a\n                            :href=\"item | msgLink\"\n                            class=\"u-msg-link\"\n                            v-if=\"hasLink(item)\"\n                            @click=\"read(item)\"\n                            target=\"_blank\"\n                        >\n                            <i class=\"el-icon-link\"></i> 点击查看\n                        </a>\n                    </span>\n                    <time class=\"u-time\">\n                        <i class=\"el-icon-phone-outline\"></i>\n                        {{ dateFormat(~~item.created) }}\n                    </time>\n                </div>\n                <el-button-group class=\"u-action\">\n                    <el-button\n                        size=\"mini\"\n                        icon=\"el-icon-check\"\n                        title=\"设为已读\"\n                        @click=\"read(item)\"\n                        :disabled=\"item.read == 1\"\n                    ></el-button>\n                    <el-button size=\"mini\" icon=\"el-icon-delete\" title=\"删除\" @click=\"del(item)\"></el-button>\n                </el-button-group>\n            </li>\n        </ul>\n        <el-alert v-else class=\"m-dashboard-box-null\" title=\"没有找到相关条目\" type=\"info\" center show-icon></el-alert>\n        <el-pagination\n            class=\"m-dashboard-box-pages\"\n            background\n            :hide-on-single-page=\"true\"\n            @current-change=\"changePage\"\n            :current-page=\"page\"\n            layout=\"total, prev, pager, next, jumper\"\n            :total=\"total\"\n        ></el-pagination>\n    </div>\n</template>\n\n<script>\nimport { getMsgs, readMsg, removeMsg } from \"../service/msg.js\";\nimport { showDate, showTime } from \"@jx3box/jx3box-common/js/moment.js\";\nimport { getLink } from \"@jx3box/jx3box-common/js/utils\";\nimport { Base64 } from \"js-base64\";\nconst ignoreLinkTypes = [\"namespace\"];\nexport default {\n    name: \"msg\",\n    props: [],\n    data: function () {\n        return {\n            keyword: \"\",\n            type: \"all\",\n            data: [],\n            unread_total: 0,\n            total: 1,\n            page: 1,\n        };\n    },\n    methods: {\n        changePage: function (i = 1) {\n            this.page = i;\n            getMsgs({\n                where: {\n                    content: this.keyword,\n                },\n                page: i,\n            }).then((res) => {\n                this.unread_total = res.data.data.unread_count;\n                this.total = res.data.data.total;\n                this.data = res.data.data.messages;\n            });\n        },\n        read(item) {\n            readMsg(item ? [item.ID] : null).then((res) => {\n                if (res.data.code === 200) {\n                    if (item) {\n                        item.read = 1;\n                    } else {\n                        this.changePage(this.page);\n                    }\n                } else {\n                    this.$notify.error({ title: res.data.message });\n                }\n            });\n        },\n        del(item) {\n            removeMsg([item.ID]).then((res) => {\n                if (res.data.code === 200) {\n                    item.deleted = Math.round(new Date() / 1000);\n                } else {\n                    this.$notify.error({ title: res.data.message });\n                }\n            });\n        },\n        dateFormat: function (val) {\n            return showTime(new Date(val * 1000));\n        },\n        hasLink: function (item) {\n            if (ignoreLinkTypes.includes(item.source_type)) {\n                return false;\n            } else if (item.source_id && item.source_type) {\n                return true;\n            }\n            return false;\n        },\n    },\n    filters: {\n        msgLink: function (item) {\n            let source_id = item.source_id;\n            let source_type = item.source_type;\n            if (source_type == \"birthday\") {\n                return (\n                    `/author/birthday/${item.user_id}?code=` +\n                    Base64.encode(source_id)\n                );\n            } else if (source_type == \"sign\") {\n                return `/dashboard/#/cooperation`;\n            } else if (source_type == \"callback\") {\n                let info = encodeURIComponent(\n                    Base64.encode(JSON.stringify(item))\n                );\n                return `/dashboard/#/${item.type}/${item.subtype}?info=${info}`;\n            } else if(source_type == 'box_coin'){\n                return `/dashboard/#/boxcoin`;\n            } else {\n                return getLink(source_type, source_id);\n            }\n        },\n    },\n    mounted: function () {\n        this.changePage();\n    },\n};\n</script>\n\n<style scoped lang=\"less\">\n@import \"../assets/css/msg.less\";\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./msg.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./msg.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./msg.vue?vue&type=template&id=0cc7b2d5&scoped=true&\"\nimport script from \"./msg.vue?vue&type=script&lang=js&\"\nexport * from \"./msg.vue?vue&type=script&lang=js&\"\nimport style0 from \"./msg.vue?vue&type=style&index=0&id=0cc7b2d5&scoped=true&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0cc7b2d5\",\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./msg.vue?vue&type=style&index=0&id=0cc7b2d5&scoped=true&lang=less&\""],"sourceRoot":""}
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-04ad7029"],{"11ad":function(t,e,i){"use strict";i("bae2")},"46e8":function(t,e,i){"use strict";i.d(e,"m",(function(){return c})),i.d(e,"d",(function(){return l})),i.d(e,"k",(function(){return o})),i.d(e,"l",(function(){return m})),i.d(e,"h",(function(){return f})),i.d(e,"a",(function(){return v})),i.d(e,"g",(function(){return p})),i.d(e,"i",(function(){return _})),i.d(e,"b",(function(){return b})),i.d(e,"n",(function(){return u})),i.d(e,"c",(function(){return d})),i.d(e,"e",(function(){return h})),i.d(e,"f",(function(){return g})),i.d(e,"j",(function(){return y}));var s=i("41cb"),n=i("bc3a"),a=i.n(n),r=i("65c2");Object(s["a"])("server",{proxy:!1});function l(){return Object(s["b"])().get("/api/cms/user/my/profile")}function c(t){return Object(s["b"])().put("/api/cms/user/my/profile",t)}function o(t){return Object(s["b"])().put("/api/cms/user/my/avatar",t)}function u(t){return Object(s["b"])().post("/api/cms/upload/avatar",t)}function d(){var t=r["__imgPath"]+"avatar/index.json";return a.a.get(t)}function h(t){return Object(s["b"])().get("/api/cms/user/".concat(t,"/info"),{params:{__no_cache:1}})}function m(t){return Object(s["b"])().put("/api/cms/user/account/email/reset-password",t,{app:"jx3box"})}function v(t){return Object(s["b"])().get("/api/cms/user/account/email/valid",{params:{email:t}})}function p(t){return Object(s["b"])().post("/api/cms/user/account/email/bind",t)}function f(t){return Object(s["b"])().put("/api/cms/user/account/email/verify",{code:t},{app:"jx3box"})}function b(){return Object(s["b"])().get("/api/cms/account/oauth/status")}function _(t){return Object(s["b"])({popType:"alert"}).delete("/api/cms/account/oauth/unbind/".concat(t))}function g(){return Object(s["b"])().get("/api/cms/wechat/mp/bind")}function y(){return Object(s["b"])().get("/api/cms/wechat/mp/unbind")}},"642b":function(t,e,i){},"644b":function(t,e,i){},9945:function(t,e,i){"use strict";function s(t){var e=Object.prototype.toString.call(t);return e.match(/\[object (.*?)\]/)[1].toLowerCase()}Object.defineProperty(e,"__esModule",{value:!0});class n{constructor(t){if("string"!==s(t))throw new Error("[Sterilizer::init] params should be string");this._symbols={"`":"`","~":"~","!":"!","@":"@","#":"#",$:"\\$","%":"%","^":"\\^","&":"&","*":"\\*","-":"\\-",_:"_","=":"=","+":"+","(":"\\(",")":"\\)","[":"\\[","]":"\\]","{":"\\{","}":"\\}","|":"\\|","\\":"\\\\","/":"/","?":"\\?",":":":",";":";","'":"'",'"':'"',">":">","<":"<",",":",",".":"\\."},this.symbols=Object.keys(this._symbols),this.regs=Object.values(this._symbols),this.str=t,this._str=t}toString(){return this._str}_detected(t){let e=s(t),i=["string","array","set"];if(!i.includes(e))throw new Error("[Sterilizer::remove] params should be string|array|set");return t}_sterilize(t){t=[...t].join("");let e=new RegExp(`[${t}]`,"gm");return this._str=this._str.replace(e,""),this}kill(t){let e=null;if(void 0==t)e=new Set(this.regs);else{this._detected(t),e=new Set;let i=new Set(t);for(let t of i)this.symbols.includes(t)&&e.add(this._symbols[t])}return this._sterilize(e)}live(t){this._detected(t);let e=new Set(this.regs);for(let i of t)this.symbols.includes(i)&&e.delete(this._symbols[i]);return this._sterilize(e)}safe(){return this.kill(["&","<",">",'"',"'","+",":","/","?","=","#","%"])}removeHSC(){return this.kill(["&","<",">",'"',"'"])}removeURL(){return this.kill(["+",":","/","?","=","&","#","%"])}removeSpace(){return this._str=this._str.replace(/\s/gm,""),this}remove(t,e){let i=new RegExp(""+t,"gm");return e=void 0!==e?e:"",this._str=this._str.replace(i,e),this}removeHTMLtag(){return this._str=this._str.replace(/<[^>]+>/gm,""),this}isDirty(t){return t?this.str.includes(t):this.symbols.some(t=>this.str.includes(t))}}function a(t){return new n(t)}class r{constructor(t,e){this.val=t,this.opt=e||{}}check(){try{if(1==this.opt.isOptional&&this.isOptional())return!0;for(let t in this.opt)if("isOptional"!=t&&!this[t](this.opt[t]))return!1;return!0}catch(t){console.error(t)}}isOptional(){let t=["",void 0,null];return!!t.includes(this.val)}is(t){if(!t instanceof RegExp)throw new Error("[Validator::is] param should be a RegExp");return t.test(this.val)}not(t){return!this.is(t)}len(t){let e=this.val.length;if("array"==s(t))return e>=t[0]&&e<=t[1];if("string"==s(t)||"number"==s(t))return e==t;throw new Error("[Validator::len] param should be array|string|number")}isIn(t){if("array"!=s(t))throw new Error("[Validator::isIn] param should be an array");return!!t.includes(this.val)}notIn(t){return!this.isIn(t)}isAlpha(t){return!t||/^[A-Z]+$/i.test(this.val)}isAlphanumeric(t){return!t||/^[A-Z0-9]+$/i.test(this.val)}isNumeric(t){return!t||/^[0-9]+$/.test(this.val)}isInt(t){return!t||/^(?:[-+]?(?:0|[1-9][0-9]*))$/.test(this.val)}isFloat(t){return!t||/^[-+]?[0-9]*\.?[0-9]+$/.test(this.val)}max(t){return this.val<=t}min(t){return this.val>=t}isChinese(t){return!t||/^[\u4e00-\u9fa5]+$/.test(this.val)}isIdentityCard(t){return!t||/^[1-9]\d{5}(18|19|20)\d{2}((0[1-9])|(1[0-2]))(([0-2][1-9])|10|20|30|31)\d{3}[0-9Xx]$/.test(this.val)}isMobilePhone(t){return!t||/^1[3456789]\d{9}$/.test(this.val)}isEmail(t){return!t||/^([A-Za-z0-9_\-\.\u4e00-\u9fa5])+@([A-Za-z0-9_\-\.])+\.([A-Za-z]{2,8})$/.test(this.val)}notEmpty(t){return!t||!/\s/gm.test(this.val)}}function l(t,e){const i=new r(t,e);return i.check()}e.Sterilizer=n,e.Validator=r,e.sterilizer=a,e.validator=l},ab43:function(t,e,i){"use strict";i.r(e);i("b0c0");var s=function(){var t=this,e=t._self._c;return e("uc",{staticClass:"m-dashboard-notice"},[e("div",{staticClass:"m-dashboard-content"},[e("el-alert",{staticClass:"u-tip",attrs:{title:"配置你的联系方式以接收魔盒通知",type:"warning","show-icon":""}}),e("div",{staticClass:"m-dashboard-content-list"},t._l(t.list,(function(i,s){return e("div",{key:s,staticClass:"m-item"},[e("span",{staticClass:"u-notice-item"},[e("img",{staticClass:"u-icon",attrs:{"svg-inline":"",src:t.icon(i.key)}}),e("span",{staticClass:"u-label"},[t._v(t._s(i.name))])]),e(i.component,{tag:"component"})],1)})),0)],1)])},n=[],a=i("b547"),r=i("65c2"),l=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-notice-wechat"},[t.isWechatVerified?[e("span",[t._v("******")]),e("el-tag",{attrs:{type:"success"}},[t._v("已绑定")]),e("el-button",{attrs:{type:"warning",icon:"el-icon-connection"},on:{click:t.unbind}},[t._v(" 解绑公众号 ")])]:e("el-button",{attrs:{type:"primary",icon:"el-icon-connection"},on:{click:t.open}},[t._v(" 绑定公众号 ")]),e("el-dialog",{attrs:{title:"绑定微信公众号",visible:t.visible,width:"30%","custom-class":"m-notice-wechat__dialog","before-close":t.handleClose},on:{"update:visible":function(e){t.visible=e}}},[e("div",{directives:[{name:"loading",rawName:"v-loading",value:t.loading,expression:"loading"}],staticClass:"m-wechat-content"},[t.ticket?e("el-image",{staticClass:"u-qr",attrs:{src:t.qrcodeValue,lazy:""}},[e("div",{staticClass:"u-error",attrs:{slot:"error"},slot:"error"},[e("i",{staticClass:"el-icon-picture-outline"})])]):t._e(),e("i",{staticClass:"u-tip"},[t._v("打开微信扫一扫，关注公众号接收通知告警")]),e("div",{directives:[{name:"show",rawName:"v-show",value:t.success,expression:"success"}],staticClass:"u-bind"},[e("i",{staticClass:"el-icon-success",staticStyle:{color:"#67c23a","margin-right":"5px"}}),e("span",{staticClass:"u-bind-text"},[t._v("绑定成功")])])],1)])],2)},c=[],o=(i("d3b7"),i("46e8")),u=i("8e44"),d=i("41cb"),h=i("c9d2"),m="https://mp.weixin.qq.com/cgi-bin/showqrcode",v={name:"wechat",data:function(){return{ticket:"",visible:!1,sse:null,profile:null,success:!1,loading:!1}},computed:{token:function(){return h["a"].getToken()},url:function(){return r["__cms"]+"api/cms/wechat/mp/bind/result?token="+this.token},isWechatVerified:function(){var t;return!(null===(t=this.profile)||void 0===t||!t.wechat_mp_openid)},qrcodeValue:function(){return"".concat(m,"?ticket=").concat(encodeURIComponent(this.ticket))}},mounted:function(){this.loadUser()},methods:{loadUser:function(){var t=this;Object(u["b"])().then((function(e){t.profile=e.data.data}))},open:function(){this.visible=!0,this.loadQrcode()},handleClose:function(){this.visible=!1,this.sse&&this.sse.disconnect()},loadQrcode:function(){var t=this;this.loading=!0,Object(o["f"])().then((function(e){var i;t.ticket=null===(i=e.data.data)||void 0===i?void 0:i.ticket,!t.isWechatVerified&&t.ticket&&(t.sse&&t.sse.disconnect(),t.initSSE())})).finally((function(){t.loading=!1}))},initSSE:function(){this.sse=new d["f"](this.url),this.sse.connect(),this.sse.on("open",(function(t){console.log("SSE Initialization")})),this.sse.on("bind_wx_mp",this.onMessage),this.sse.on("error",(function(t){console.log("SSE Error",t)}))},onMessage:function(){var t=this;this.success=!0,this.profile.wechat_mp_openid=!0,setTimeout((function(){t.visible=!1}),4e3)},unbind:function(){var t=this;this.$confirm("解绑后无法用微信接收魔盒通知消息，确定解绑吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){Object(o["j"])().then((function(){t.$notify({title:"解绑成功",type:"success",duration:2e3}),t.loadUser()}))}))}}},p=v,f=(i("11ad"),i("2877")),b=Object(f["a"])(p,l,c,!1,null,null,null),_=b.exports,g=function(){var t=this,e=t._self._c;return e("div",{staticClass:"m-notice-email"},[t.address?e("span",{staticClass:"u-address"},[t._v(t._s(t.blurAddress(t.address)))]):t._e(),t.verified?e("el-tag",{attrs:{type:"success"}},[t._v("已绑定")]):t._e(),e("el-button",{staticClass:"u-button",attrs:{type:"primary",icon:"el-icon-edit"},on:{click:function(e){t.visible=!0}}},[t._v(" "+t._s(t.address?t.verified?"修改邮箱":"验证邮箱":"绑定邮箱")+" ")]),e("el-dialog",{attrs:{visible:t.visible,width:"40%","custom-class":"m-notice-email__dialog","before-close":t.handleClose},on:{"update:visible":function(e){t.visible=e}}},[e("div",{staticClass:"m-profile-email"},[e("img",{staticClass:"u-pic",attrs:{src:i("b416")}}),1==t.status?e("div",{staticClass:"u-done"},[1==t.verified?[e("h1",{staticClass:"u-title"},[t._v("已绑定邮箱")]),e("p",{staticClass:"u-address"},[t._v("当前绑定邮箱："),e("span",{staticClass:"u-current-email"},[t._v(t._s(t.currentEmail))])]),e("div",{staticClass:"u-btngroup"},[e("el-button",{staticClass:"u-button",attrs:{type:"primary",icon:"el-icon-edit"},on:{click:t.changeEmail}},[t._v("修改邮箱")])],1)]:t._e(),0==t.verified?[e("h1",{staticClass:"u-title"},[t._v("未验证邮箱")]),e("p",{staticClass:"u-address"},[t._v(t._s(t.address))]),e("div",{staticClass:"u-code"},[e("el-input",{staticStyle:{width:"300px"},attrs:{placeholder:"验证码",size:"large"},scopedSlots:t._u([{key:"prepend",fn:function(){return[e("i",{staticClass:"el-icon-lock"})]},proxy:!0}],null,!1,3435964630),model:{value:t.code,callback:function(e){t.code=e},expression:"code"}})],1),e("el-alert",{staticClass:"u-tip",attrs:{title:"未验证邮箱",type:"warning",description:"请尽快进行邮箱验证,否则您的账号将面临风险与权限受阻","show-icon":"",closable:!1}}),e("div",{staticClass:"u-btngroup"},[e("el-button",{staticClass:"u-button",attrs:{type:"primary",icon:"el-icon-s-promotion"},on:{click:t.verify}},[t._v("验证邮箱")]),e("el-button",{staticClass:"u-button",attrs:{type:"primary",icon:"el-icon-edit"},on:{click:t.changeEmail}},[t._v("修改邮箱")])],1)]:t._e()],2):t._e(),0==t.status?e("div",{staticClass:"u-none"},[e("h1",{staticClass:"u-title"},[t._v(" "+t._s(t.changeEmailMode?"修改邮箱":"未绑定邮箱")+" ")]),e("p",{staticClass:"u-address"},[t._v("当前绑定邮箱："),e("span",{staticClass:"u-current-email"},[t._v(t._s(t.currentEmail))])]),e("div",{staticClass:"u-email"},[e("el-input",{staticClass:"u-text u-email",attrs:{placeholder:"邮箱地址",minlength:"3",maxlength:"50"},on:{change:t.checkEmail},model:{value:t.email,callback:function(e){t.email=e},expression:"email"}},[e("template",{slot:"prepend"},[e("svg",{staticClass:"octicon octicon-mail",class:"i-mail",attrs:{viewBox:"0 0 14 16",width:"14",height:"16","aria-hidden":"true","svg-inline":"",role:"presentation",focusable:"false",tabindex:"-1"}},[e("path",{attrs:{"fill-rule":"evenodd",d:"M0 4v8c0 .55.45 1 1 1h12c.55 0 1-.45 1-1V4c0-.55-.45-1-1-1H1c-.55 0-1 .45-1 1zm13 0L7 9 1 4h12zM1 5.5l4 3-4 3v-6zM2 12l3.5-3L7 10.5 8.5 9l3.5 3H2zm11-.5l-4-3 4-3v6z"}})])])],2),e("div",{staticClass:"u-error"},[e("el-alert",{directives:[{name:"show",rawName:"v-show",value:0==t.email_validate,expression:"email_validate == false"}],attrs:{title:t.email_validate_tip,type:"error","show-icon":"",closable:!1}}),e("el-alert",{directives:[{name:"show",rawName:"v-show",value:0==t.email_available,expression:"email_available == false"}],attrs:{title:t.email_available_tip,type:"error","show-icon":"",closable:!1}})],1),e("i",{directives:[{name:"show",rawName:"v-show",value:t.ready,expression:"ready"}],staticClass:"el-icon-success el-icons-status"})],1),e("div",{staticClass:"u-btngroup"},[e("el-button",{staticClass:"u-button",attrs:{type:"primary",disabled:!t.ready},on:{click:t.bind}},[t._v("绑定邮箱")])],1)]):t._e()])])],1)},y=[],w=(i("ac1f"),i("5319"),i("9945")),C={name:"email",data:function(){return{status:null,address:"",verified:null,visible:!1,email:"",email_validate:null,email_validate_tip:"邮箱格式不正确或长度超出限制",email_available:null,email_available_tip:"邮箱已被使用,请更换",changeEmailMode:!1,code:"",currentEmail:""}},computed:{ready:function(){return this.email_validate&&this.email_available}},methods:{verify:function(){var t=this;Object(o["h"])(this.code).then((function(e){t.$message.success("验证成功，请重新登录"),t.verified=!0,t.visible=!1,h["a"].destroy().then((function(){h["a"].toLogin()}))}))},checkEmail:function(){var t=this;if(""==this.email)return this.email_validate=null,void(this.email_available=null);var e=Object(w["validator"])(this.email,{isEmail:!0,len:[3,50]});this.email_validate=e,e&&Object(o["a"])(this.email).then((function(e){var i;t.email_available=!(null!==(i=e.data.data)&&void 0!==i&&i.isExist)}))},bind:function(){var t=this;this.ready?Object(o["g"])({email:this.email}).then((function(e){t.$alert("申请提交成功,请前往邮箱验证","消息",{confirmButtonText:"确定"}),t.status=!0,t.verified=!1,t.address=t.email})):this.$message.error("邮箱地址不合法")},changeEmail:function(){this.status=!1,this.changeEmailMode=!0},handleClose:function(){this.visible=!1},blurAddress:function(t){return t.replace(/(.{2}).*(.{0}@.*)/,"$1****$2")},load:function(){var t=this;Object(o["d"])().then((function(e){var i=e.data.data;t.address=null===i||void 0===i?void 0:i.user_email,t.currentEmail=null===i||void 0===i?void 0:i.user_email,t.verified=null===i||void 0===i?void 0:i.verify_email,t.status=!(null===i||void 0===i||!i.user_email)}))}},mounted:function(){this.load()}},k=C,x=(i("f2cc"),Object(f["a"])(k,g,y,!1,null,null,null)),j=x.exports,O={name:"notice",components:{uc:a["a"],wechat:_,email:j},data:function(){return{list:[{key:"email",name:"邮箱",component:j},{key:"wechat",name:"微信",component:_}]}},methods:{icon:function(t){return r["__imgPath"]+"image/connect/"+t+".svg"}},mounted:function(){}},E=O,S=(i("dbcb"),Object(f["a"])(E,s,n,!1,null,null,null));e["default"]=S.exports},b416:function(t,e,i){t.exports=i.p+"img/email.38ec90b7.png"},bae2:function(t,e,i){},dbcb:function(t,e,i){"use strict";i("644b")},f2cc:function(t,e,i){"use strict";i("642b")}}]);
//# sourceMappingURL=chunk-04ad7029.ef450ae1.js.map
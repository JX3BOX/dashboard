{"version":3,"sources":["webpack:///./src/views/msg.vue?f2b1","webpack:///./src/service/msg.js","webpack:///src/views/msg.vue","webpack:///./src/views/msg.vue?28b0","webpack:///./src/views/msg.vue","webpack:///./src/views/msg.vue?3b51"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","data","_l","item","i","directives","name","rawName","value","deleted","expression","key","class","on","read","domProps","_s","content","source_id","source_type","attrs","_f","$event","_e","dateFormat","created","del","page","total","changePage","unread_total","staticRenderFns","qs","require","getMsgs","$http","get","headers","Accept","params","readMsg","ids","put","stringify","removeMsg","component"],"mappings":"yHAAA,IAAIA,EAAS,WAAa,IAAIC,EAAIC,KAASC,EAAGF,EAAIG,eAAmBC,EAAGJ,EAAIK,MAAMD,IAAIF,EAAG,OAAOE,EAAG,MAAM,CAACE,YAAY,gDAAgD,CAACF,EAAG,KAAK,CAACE,YAAY,WAAW,CAACN,EAAIO,GAAG,UAAWP,EAAIQ,KAAW,OAAEJ,EAAG,KAAK,CAACE,YAAY,wBAAwBN,EAAIS,GAAIT,EAAQ,MAAE,SAASU,EAAKC,GAAG,OAAOP,EAAG,KAAK,CAACQ,WAAW,CAAC,CAACC,KAAK,OAAOC,QAAQ,SAASC,MAAuB,GAAhBL,EAAKM,QAAcC,WAAW,sBAAsBC,IAAIP,EAAEQ,MAAM,CAAEC,GAAiB,GAAbV,EAAKW,OAAa,CAACjB,EAAG,MAAM,CAACE,YAAY,aAAa,CAACF,EAAG,OAAO,CAACE,YAAY,aAAa,CAAe,GAAbI,EAAKW,KAAWjB,EAAG,OAAO,CAACE,YAAY,wBAAwB,CAACN,EAAIO,GAAG,QAAQH,EAAG,OAAO,CAACE,YAAY,2BAA2B,CAACN,EAAIO,GAAG,QAAQH,EAAG,OAAO,CAACkB,SAAS,CAAC,UAAYtB,EAAIuB,GAAGb,EAAKc,YAAad,EAAKe,WAAaf,EAAKgB,YAAatB,EAAG,IAAI,CAACE,YAAY,aAAaqB,MAAM,CAAC,KAAO3B,EAAI4B,GAAG,UAAP5B,CAAkBU,GAAM,OAAS,UAAUU,GAAG,CAAC,MAAQ,SAASS,GAAQ,OAAO7B,EAAIqB,KAAKX,MAAS,CAACN,EAAG,IAAI,CAACE,YAAY,iBAAiBN,EAAIO,GAAG,WAAWP,EAAI8B,OAAO1B,EAAG,OAAO,CAACE,YAAY,UAAU,CAACF,EAAG,IAAI,CAACE,YAAY,0BAA0BN,EAAIO,GAAG,IAAIP,EAAIuB,GAAGvB,EAAI+B,aAAarB,EAAKsB,eAAe5B,EAAG,kBAAkB,CAACE,YAAY,YAAY,CAACF,EAAG,YAAY,CAACuB,MAAM,CAAC,KAAO,OAAO,KAAO,gBAAgB,MAAQ,OAAO,SAAwB,GAAbjB,EAAKW,MAAWD,GAAG,CAAC,MAAQ,SAASS,GAAQ,OAAO7B,EAAIqB,KAAKX,OAAUN,EAAG,YAAY,CAACuB,MAAM,CAAC,KAAO,OAAO,KAAO,iBAAiB,MAAQ,MAAMP,GAAG,CAAC,MAAQ,SAASS,GAAQ,OAAO7B,EAAIiC,IAAIvB,QAAW,IAAI,MAAK,GAAGN,EAAG,WAAW,CAACE,YAAY,uBAAuBqB,MAAM,CAAC,MAAQ,WAAW,KAAO,OAAO,OAAS,GAAG,YAAY,MAAMvB,EAAG,gBAAgB,CAACE,YAAY,wBAAwBqB,MAAM,CAAC,WAAa,GAAG,uBAAsB,EAAK,eAAe3B,EAAIkC,KAAK,OAAS,mCAAmC,MAAQlC,EAAImC,OAAOf,GAAG,CAAC,iBAAiBpB,EAAIoC,cAAchC,EAAG,YAAY,CAACE,YAAY,aAAaqB,MAAM,CAAC,KAAO,UAAU,KAAO,OAAO,UAAY3B,EAAIqC,cAAcjB,GAAG,CAAC,MAAQ,SAASS,GAAQ,OAAO7B,EAAIqB,KAAK,SAAS,CAACjB,EAAG,IAAI,CAACE,YAAY,0BAA0BF,EAAG,OAAO,CAACkB,SAAS,CAAC,YAActB,EAAIuB,GAAG,gBAAgB,IAC1iEe,EAAkB,G,YCEhBC,EAAKC,EAAQ,QAEnB,SAASC,IAAe,IAAP9B,EAAO,uDAAH,EACjB,OAAO+B,OAAMC,IAAI,gBAAiB,CAC9BC,QAAS,CAAEC,OAAQ,kCACnBC,OAAQ,CAEJZ,KAAMvB,KAKlB,SAASoC,EAAQC,GACb,IAAIxC,EAAO,GAGX,OAFIwC,IAAKxC,EAAKwC,IAAMA,GAEbN,OAAMO,IAAN,qBAAgCV,EAAGW,UAAU1C,GAAO,CACvDoC,QAAS,CAAEC,OAAQ,oCAI3B,SAASM,EAAUH,GACf,OAAON,OAAMO,IAAN,uBAEHV,EAAGW,UAAU,CACTF,IAAKA,IAET,CACIJ,QAAS,CAAEC,OAAQ,oC,4BCqD/B,GACE,KAAF,MACE,MAAF,GACE,KAAF,WACI,MAAJ,CACM,KAAN,MACM,KAAN,GACM,aAAN,EACM,MAAN,EACM,KAAN,IAGE,QAAF,CACI,WAAJ,WAAM,IAAN,kEACM,KAAN,OACM,EAAN,qBACQ,EAAR,sCACQ,EAAR,wBACQ,EAAR,8BAGI,KATJ,SASA,GAAM,IAAN,OACM,EAAN,iCACA,kBACA,EACY,EAAZ,OAEY,EAAZ,mBAGU,EAAV,eAAY,MAAZ,qBAII,IAtBJ,SAsBA,GAAM,IAAN,OACM,EAAN,0BACA,kBACU,EAAV,iCAEU,EAAV,eAAY,MAAZ,qBAII,WAAJ,YACM,OAAN,kCAGE,QAAF,CACI,QAAJ,YACM,IAAN,cACA,gBACM,OAAN,4BAGE,QAAF,WACI,KAAJ,eC3IwY,I,wBCQpYO,EAAY,eACd,EACArD,EACAuC,GACA,EACA,KACA,WACA,MAIa,aAAAc,E,kECnBf,yBAAyqB,EAAG","file":"js/chunk-724c489d.cb16a74a.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"m-dashboard m-dashboard-work m-dashboard-msg\"},[_c('h2',{staticClass:\"u-title\"},[_vm._v(\"我的消息\")]),(_vm.data.length)?_c('ul',{staticClass:\"m-dashboard-box-list\"},_vm._l((_vm.data),function(item,i){return _c('li',{directives:[{name:\"show\",rawName:\"v-show\",value:(item.deleted == 0),expression:\"item.deleted == 0\"}],key:i,class:{ on: item.read == 1 }},[_c('div',{staticClass:\"u-primary\"},[_c('span',{staticClass:\"u-content\"},[(item.read == 1)?_c('span',{staticClass:\"u-label u-hasChecked\"},[_vm._v(\"已读\")]):_c('span',{staticClass:\"u-label u-hasNotChecked\"},[_vm._v(\"未读\")]),_c('span',{domProps:{\"innerHTML\":_vm._s(item.content)}}),(item.source_id && item.source_type)?_c('a',{staticClass:\"u-msg-link\",attrs:{\"href\":_vm._f(\"msgLink\")(item),\"target\":\"_blank\"},on:{\"click\":function($event){return _vm.read(item)}}},[_c('i',{staticClass:\"el-icon-link\"}),_vm._v(\" 点击查看\")]):_vm._e()]),_c('time',{staticClass:\"u-time\"},[_c('i',{staticClass:\"el-icon-phone-outline\"}),_vm._v(\" \"+_vm._s(_vm.dateFormat(~~item.created)))])]),_c('el-button-group',{staticClass:\"u-action\"},[_c('el-button',{attrs:{\"size\":\"mini\",\"icon\":\"el-icon-check\",\"title\":\"设为已读\",\"disabled\":item.read == 1},on:{\"click\":function($event){return _vm.read(item)}}}),_c('el-button',{attrs:{\"size\":\"mini\",\"icon\":\"el-icon-delete\",\"title\":\"删除\"},on:{\"click\":function($event){return _vm.del(item)}}})],1)],1)}),0):_c('el-alert',{staticClass:\"m-dashboard-box-null\",attrs:{\"title\":\"没有找到相关条目\",\"type\":\"info\",\"center\":\"\",\"show-icon\":\"\"}}),_c('el-pagination',{staticClass:\"m-dashboard-box-pages\",attrs:{\"background\":\"\",\"hide-on-single-page\":true,\"current-page\":_vm.page,\"layout\":\"total, prev, pager, next, jumper\",\"total\":_vm.total},on:{\"current-change\":_vm.changePage}}),_c('el-button',{staticClass:\"u-read-all\",attrs:{\"type\":\"primary\",\"size\":\"mini\",\"disabled\":!_vm.unread_total},on:{\"click\":function($event){return _vm.read(null)}}},[_c('i',{staticClass:\"el-icon el-icon-check\"}),_c('span',{domProps:{\"textContent\":_vm._s('全部设为已读')}})])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { $http } from \"./axios\";\n// import { __helperUrl } from \"@jx3box/jx3box-common/js/jx3box.json\";\n\nconst qs = require(\"qs\");\n\nfunction getMsgs(i = 1) {\n    return $http.get(\"/api/messages\", {\n        headers: { Accept: \"application/prs.helper.v2+json\" },\n        params: {\n            // length : 2,\n            page: i,\n        },\n    });\n}\n\nfunction readMsg(ids) {\n    let data = {};\n    if (ids) data.ids = ids;\n\n    return $http.put(`/api/messages/read`, qs.stringify(data), {\n        headers: { Accept: \"application/prs.helper.v2+json\" },\n    });\n}\n\nfunction removeMsg(ids) {\n    return $http.put(\n        `/api/messages/remove`,\n        qs.stringify({\n            ids: ids,\n        }),\n        {\n            headers: { Accept: \"application/prs.helper.v2+json\" },\n        }\n    );\n}\n\nexport { getMsgs, readMsg, removeMsg };\n","<template>\n    <div class=\"m-dashboard m-dashboard-work m-dashboard-msg\">\n        <h2 class=\"u-title\">我的消息</h2>\n        <ul class=\"m-dashboard-box-list\" v-if=\"data.length\">\n            <li\n                v-for=\"(item, i) in data\"\n                :key=\"i\"\n                :class=\"{ on: item.read == 1 }\"\n                v-show=\"item.deleted == 0\"\n            >\n                <div class=\"u-primary\">\n                    <span class=\"u-content\">\n                        <span class=\"u-label u-hasChecked\" v-if=\"item.read == 1\"\n                            >已读</span\n                        >\n                        <span class=\"u-label u-hasNotChecked\" v-else>未读</span>\n                        <span v-html=\"item.content\"></span>\n                        <a\n                            :href=\"item | msgLink\"\n                            class=\"u-msg-link\"\n                            v-if=\"item.source_id && item.source_type\"\n                            @click=\"read(item)\"\n                            target=\"_blank\"\n                            ><i class=\"el-icon-link\"></i> 点击查看</a\n                        >\n                    </span>\n                    <time class=\"u-time\"\n                        ><i class=\"el-icon-phone-outline\"></i>\n                        {{ dateFormat(~~item.created) }}</time\n                    >\n                </div>\n                <el-button-group class=\"u-action\">\n                    <el-button\n                        size=\"mini\"\n                        icon=\"el-icon-check\"\n                        title=\"设为已读\"\n                        @click=\"read(item)\"\n                        :disabled=\"item.read == 1\"\n                    ></el-button>\n                    <el-button\n                        size=\"mini\"\n                        icon=\"el-icon-delete\"\n                        title=\"删除\"\n                        @click=\"del(item)\"\n                    ></el-button>\n                </el-button-group>\n            </li>\n        </ul>\n        <el-alert\n            v-else\n            class=\"m-dashboard-box-null\"\n            title=\"没有找到相关条目\"\n            type=\"info\"\n            center\n            show-icon\n        >\n        </el-alert>\n        <el-pagination\n            class=\"m-dashboard-box-pages\"\n            background\n            :hide-on-single-page=\"true\"\n            @current-change=\"changePage\"\n            :current-page=\"page\"\n            layout=\"total, prev, pager, next, jumper\"\n            :total=\"total\"\n        >\n        </el-pagination>\n        <el-button\n            class=\"u-read-all\"\n            type=\"primary\"\n            size=\"mini\"\n            @click=\"read(null)\"\n            :disabled=\"!unread_total\"\n        >\n            <i class=\"el-icon el-icon-check\"></i>\n            <span v-text=\"'全部设为已读'\"></span>\n        </el-button>\n    </div>\n</template>\n\n<script>\nimport { getMsgs, readMsg, removeMsg } from \"../service/msg.js\";\nimport { showDate, showTime } from \"@jx3box/jx3box-common/js/moment.js\";\nimport { getLink } from \"@jx3box/jx3box-common/js/utils\";\nexport default {\n    name: \"msg\",\n    props: [],\n    data: function() {\n        return {\n            type: \"all\",\n            data: [],\n            unread_total: 0,\n            total: 1,\n            page: 1,\n        };\n    },\n    methods: {\n        changePage: function(i = 1) {\n            this.page = i;\n            getMsgs(i).then((res) => {\n                this.unread_total = res.data.data.unread_count;\n                this.total = res.data.data.total;\n                this.data = res.data.data.messages;\n            });\n        },\n        read(item) {\n            readMsg(item ? [item.ID] : null).then((res) => {\n                if (res.data.code === 200) {\n                    if (item) {\n                        item.read = 1;\n                    } else {\n                        this.changePage(this.page);\n                    }\n                } else {\n                    this.$notify.error({ title: res.data.message });\n                }\n            });\n        },\n        del(item) {\n            removeMsg([item.ID]).then((res) => {\n                if (res.data.code === 200) {\n                    item.deleted = Math.round(new Date() / 1000);\n                } else {\n                    this.$notify.error({ title: res.data.message });\n                }\n            });\n        },\n        dateFormat: function(val) {\n            return showTime(new Date(val * 1000));\n        },\n    },\n    filters: {\n        msgLink: function(item) {\n            let id = item.source_id;\n            let type = item.source_type;\n            return getLink(type, id);\n        },\n    },\n    mounted: function() {\n        this.changePage();\n    },\n};\n</script>\n\n<style scoped lang=\"less\">\n@import \"../assets/css/msg.less\";\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./msg.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./msg.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./msg.vue?vue&type=template&id=43035b90&scoped=true&\"\nimport script from \"./msg.vue?vue&type=script&lang=js&\"\nexport * from \"./msg.vue?vue&type=script&lang=js&\"\nimport style0 from \"./msg.vue?vue&type=style&index=0&id=43035b90&scoped=true&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"43035b90\",\n  null\n  \n)\n\nexport default component.exports","import mod from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--10-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./msg.vue?vue&type=style&index=0&id=43035b90&scoped=true&lang=less&\"; export default mod; export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--10-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./msg.vue?vue&type=style&index=0&id=43035b90&scoped=true&lang=less&\""],"sourceRoot":""}
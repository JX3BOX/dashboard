(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-35809a7c"],{"0af0":function(t,e,n){},"3a16":function(t,e,n){"use strict";n.r(e);var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"m-publish-box"},[n("pubheader",{attrs:{name:"剑三小册",localDraft:!1}},[t._t("header")],2),n("el-form",{staticClass:"m-publish-collection",attrs:{"label-position":"left"}},[n("div",{staticClass:"m-publish-title"},[n("el-divider",{attrs:{"content-position":"left"}},[t._v("标题")]),n("el-input",{attrs:{placeholder:"请输入剑三小册标题",maxlength:"20","show-word-limit":""},model:{value:t.collection.title,callback:function(e){t.$set(t.collection,"title",e)},expression:"collection.title"}})],1),n("el-row",{attrs:{gutter:30}},[n("el-col",{staticClass:"m-publish-image",attrs:{span:6}},[n("el-divider",{attrs:{"content-position":"left"}},[t._v("封面图")]),n("post_banner",{attrs:{banner:t.collection.image}})],1),n("el-col",{attrs:{span:18}},[n("div",{staticClass:"m-publish-public"},[n("el-divider",{attrs:{"content-position":"left"}},[t._v("可见性")]),n("el-radio",{attrs:{label:2},model:{value:t.collection.public,callback:function(e){t.$set(t.collection,"public",e)},expression:"collection.public"}},[t._v("公开")]),n("el-radio",{attrs:{label:1},model:{value:t.collection.public,callback:function(e){t.$set(t.collection,"public",e)},expression:"collection.public"}},[t._v("私有")])],1),n("div",{staticClass:"m-publish-tags"},[n("el-divider",{attrs:{"content-position":"left"}},[t._v("标签（选填）")]),n("ul",{staticClass:"m-list-style"},t._l(t.collection.tags,(function(e,i){return n("li",{key:i,staticClass:"m-tag"},[n("span",{domProps:{textContent:t._s(e)}}),n("i",{staticClass:"el-icon-close",on:{click:function(e){return t.collection.tags.splice(i,1)}}})])})),0),t.collection.tags.length<5?n("div",{staticClass:"m-tag-add"},[n("el-input",{staticClass:"u-tag-add-value",attrs:{placeholder:"请输入标签（最多为5个）"},model:{value:t.tag,callback:function(e){t.tag=e},expression:"tag"}}),n("el-button",{staticClass:"u-tag-add",on:{click:function(){t.tag&&t.collection.tags.push(t.tag),t.tag=""}}},[n("i",{staticClass:"el-icon-plus"})])],1):t._e()],1)])],1),n("div",{staticClass:"m-publish-description"},[n("el-divider",{attrs:{"content-position":"left"},on:{click:function(e){t.show_description=!t.show_description}}},[t._v("描述（选填）")]),t.show_description?t._e():n("span",{staticClass:"u-show",on:{click:function(e){t.show_description=!0}}},[t._v("▼ 展开")]),t.show_description?n("span",{staticClass:"u-hide",on:{click:function(e){t.show_description=!1}}},[t._v("▲ 收起")]):t._e(),n("Tinymce",{directives:[{name:"show",rawName:"v-show",value:t.show_description,expression:"show_description"}],attrs:{attachmentEnable:!0,resourceEnable:!0,height:300},model:{value:t.collection.description,callback:function(e){t.$set(t.collection,"description",e)},expression:"collection.description"}})],1),n("div",{staticClass:"m-publish-content"},[n("el-divider",{attrs:{"content-position":"left"}},[t._v("内容")]),n("div",{staticClass:"u-content-add",on:{click:t.add_content_item}},[n("i",{staticClass:"el-icon-plus"}),n("span",[t._v(" 添加文章")])]),t.collection.content&&t.collection.content.length?n("draggable",{staticClass:"m-list-style",attrs:{tag:"ul",list:t.collection.content,handle:".u-move"}},t._l(t.collection.content,(function(e,i){return n("li",{key:i,staticClass:"c-content-item"},[n("i",{staticClass:"u-move el-icon-more"}),n("i",{staticClass:"u-delete el-icon-close",on:{click:function(e){return t.collection.content.splice(i,1)}}}),n("el-row",{staticClass:"m-content-item",attrs:{gutter:10}},[n("el-col",{attrs:{span:4}},[n("el-select",{staticClass:"u-item-key",attrs:{placeholder:"请选择文章类型"},on:{change:function(){t.search_handle(null,e),e.url=e.title=""}},model:{value:e.type,callback:function(n){t.$set(e,"type",n)},expression:"item.type"}},t._l(t.source_types,(function(t,e){return n("el-option",{key:e,attrs:{label:t,value:e}})})),1)],1),n("el-col",{attrs:{span:8}},["custom"!==e.type?n("el-select",{staticClass:"u-item-value",attrs:{filterable:"",remote:"",placeholder:"通过输入文章标题进行搜索","remote-method":function(n){t.search_handle(n,e)}},on:{change:function(n){t.title_fill(n,e)}},model:{value:e.id,callback:function(n){t.$set(e,"id",n)},expression:"item.id"}},[t._l(e.posts,(function(e){return[e.id&&e.title?n("el-option",{key:e.id,attrs:{value:e.id,label:e.title}}):t._e()]}))],2):n("el-input",{staticClass:"u-item-value",attrs:{placeholder:"请输入URL链接"},model:{value:e.url,callback:function(n){t.$set(e,"url",n)},expression:"item.url"}})],1),e.url?n("el-col",{attrs:{span:12}},[n("el-input",{attrs:{placeholder:"请输入自定义标题"},model:{value:e.title,callback:function(n){t.$set(e,"title",n)},expression:"item.title"}})],1):t._e()],1)],1)})),0):n("div",{staticClass:"u-content-items-empty"},[t._v("暂无文章信息，请进行文章添加")])],1),n("el-form-item",[n("el-button",{staticClass:"u-publish",attrs:{icon:"el-icon-s-promotion",type:"success",loading:t.$store.state.processing},on:{click:t.submit}},[t._v("提交剑三小册 ")])],1)],1)],1)},s=[],l=(n("99af"),n("221a")),o=n("a0fa"),c=n("7825"),a=n("b76a"),r=n.n(a),u=n("2777"),p=n("ee8f"),d=n("4328");function m(t){return Object(u["a"])({method:"GET",url:"".concat(p["JX3BOX"].__helperUrl,"api/post/collection/").concat(t),headers:{Accept:"application/prs.helper.v2+json"}})}function h(t){return Object(u["a"])({method:"POST",url:"".concat(p["JX3BOX"].__helperUrl,"api/post/collection"),headers:{Accept:"application/prs.helper.v2+json"},data:d.stringify({action:t.id?"update":"create",collection:t})})}n("4328");function f(t,e){return Object(u["a"])({method:"GET",url:"".concat(p["JX3BOX"].__helperUrl,"api/posts/").concat(t),headers:{Accept:"application/prs.helper.v2+json"},params:e})}var _=n("64c7"),v=_.__postType,b=_.__otherType,g=(n("4328"),n("2ef0"),{name:"item",props:[],data:function(){var t=Object.assign(v,b);return t["custom"]="自定义",delete t["cj"],{source_types:t,collection:{id:"",title:"",public:"",image:"",description:"",tags:[],content:[]},tag:"",show_description:!1}},mounted:function(){var t=this;this.collection.content.length||this.add_content_item(),this.$route.params.collection_id&&m(this.$route.params.collection_id).then((function(e){if(e=e.data,200===e.code){var n=e.data.collection;for(var i in n.content){var s=n.content[i];s.posts="custom"===s.type?null:[{id:s.id,title:s.title}]}t.collection=e.data.collection}}))},methods:{title_fill:function(t,e){var n=e.posts[t];e.title=n&&n.title?n.title:""},add_content_item:function(){this.collection.content.push({title:"",type:"",id:"",url:"",posts:null})},search_handle:function(t,e){null===t&&(e.id=t=""),f(e.type,{keyword:t}).then((function(t){t=t.data,200===t.code&&(e.posts=t.data.posts)}))},submit:function(){var t=this;this.$confirm("确定提交剑三小册信息？","提示",{type:"info"}).then((function(){var e=JSON.parse(JSON.stringify(t.collection));if(e.content.length){for(var n in e.content)delete e.content[n].posts;e.content=JSON.stringify(e.content),t.$store.commit("startProcess"),h(e).then((function(e){e=e.data,200===e.code?(t.$message({message:e.message,type:"success"}),location.href="".concat(__Root,"collection/#/view/").concat(e.data.collection.id)):t.$message({message:"".concat(e.message),type:"warning"})}))}else t.$message({message:"要添加剑三小册内文章哦",type:"warning"})}))}},components:{Tinymce:l["a"],draggable:r.a,pubheader:o["a"],post_banner:c["a"]}}),C=g,w=(n("cee3"),n("2877")),y=Object(w["a"])(C,i,s,!1,null,null,null);e["default"]=y.exports},7825:function(t,e,n){"use strict";var i=function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticClass:"m-publish-banner"},[n("el-alert",{staticClass:"u-tip",attrs:{title:"图片尺寸180*100像素，非必选，部分栏目不会展示海报，分享功能将使用该图作为预览图",type:"info","show-icon":""}}),n("el-upload",{staticClass:"avatar-uploader",attrs:{action:t.url,"show-file-list":!1,"on-success":t.done,"on-error":t.fail,"with-credentials":"",accept:"image/jpg,image/jpeg,image/gif,image/png,image/bmp"}},[t.post_banner?n("img",{attrs:{src:t._f("showBanner")(t.post_banner)}}):n("i",{staticClass:"el-icon-plus avatar-uploader-icon"})]),n("el-button",{staticClass:"u-remove",attrs:{type:"info",size:"mini",icon:"el-icon-circle-close"},on:{click:t.clearBanner}},[t._v("移除海报")])],1)},s=[],l=(n("99af"),n("64c7")),o=n("85e4"),c=l["__server"]+"upload",a={name:"post_banner",props:["banner"],data:function(){return{post_banner:this.banner,url:c}},methods:{done:function(t,e){this.post_banner=t.data.list[0],this.$store.commit("editBanner",this.post_banner)},fail:function(t,e,n){try{var i=JSON.parse(t.message);this.$message.error("[".concat(i.code,"]").concat(i.msg))}catch(s){this.$message.error("网络请求异常")}},clearBanner:function(){this.post_banner="",this.$store.commit("editBanner",this.post_banner)}},filters:{showBanner:function(t){return Object(o["showMinibanner"])(t)}}},r=a,u=(n("c383"),n("2877")),p=Object(u["a"])(r,i,s,!1,null,null,null);e["a"]=p.exports},c383:function(t,e,n){"use strict";var i=n("c515"),s=n.n(i);s.a},c515:function(t,e,n){},cee3:function(t,e,n){"use strict";var i=n("0af0"),s=n.n(i);s.a}}]);
//# sourceMappingURL=chunk-35809a7c.10ce541b.js.map
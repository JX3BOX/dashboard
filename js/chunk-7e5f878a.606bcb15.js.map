{"version":3,"sources":["webpack:///./src/publish/item.vue?1a63","webpack:///src/publish/item.vue","webpack:///./src/publish/item.vue?3a39","webpack:///./src/publish/item.vue","webpack:///./src/publish/item.vue?caa5","webpack:///./src/service/item.js","webpack:///./src/service/wiki_post.js","webpack:///./node_modules/@jx3box/jx3box-common/main.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","_t","_v","post","id","goto_search_items","options","search_loading","model","value","callback","$$v","$set","expression","_l","item","key","Name","icon_url_filter","IconID","domProps","_s","processing","on","toPublish","staticRenderFns","component","search_items","keyword","length","fields","is_equip","params","limit","$helper","method","url","get_item_newest_post","item_id","type","source_id","supply","get_newest_post","create_post","data","qs","stringify","JX3BOX","SEO","module","exports"],"mappings":"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","file":"js/chunk-7e5f878a.606bcb15.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"m-publish-box\"},[_c('pubheader',{attrs:{\"name\":\"物品百科\"}},[_vm._t(\"header\")],2),_c('el-form',{staticClass:\"m-publish-post\"},[_c('div',{staticClass:\"m-publish-source\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"选择物品 *\")]),_c('el-select',{staticClass:\"u-source-id\",attrs:{\"filterable\":\"\",\"remote\":\"\",\"disabled\":!!_vm.post.id,\"placeholder\":\"输入物品名称/物品描述并按『回车』进行搜索\",\"remote-method\":_vm.goto_search_items,\"loading\":_vm.options.search_loading},model:{value:(_vm.post.source_id),callback:function ($$v) {_vm.$set(_vm.post, \"source_id\", $$v)},expression:\"post.source_id\"}},_vm._l((_vm.options.items),function(item){return _c('el-option',{key:item.id,attrs:{\"label\":item.Name,\"value\":item.id}},[_c('div',{staticClass:\"m-selector-item\"},[_c('img',{staticClass:\"u-icon\",attrs:{\"src\":_vm.icon_url_filter(item.IconID),\"alt\":item.Name}}),_c('span',{staticClass:\"u-name\",domProps:{\"textContent\":_vm._s(item.Name)}})])])}),1)],1),_c('div',{staticClass:\"m-publish-level\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"综合难度 *\")]),_c('el-rate',{staticClass:\"u-level\",model:{value:(_vm.post.level),callback:function ($$v) {_vm.$set(_vm.post, \"level\", $$v)},expression:\"post.level\"}})],1),_c('div',{staticClass:\"m-publish-remark\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"修订说明 *\")]),_c('el-input',{attrs:{\"placeholder\":\"请简单描述一下本次修订的说明\"},model:{value:(_vm.post.remark),callback:function ($$v) {_vm.$set(_vm.post, \"remark\", $$v)},expression:\"post.remark\"}})],1),_c('div',{staticClass:\"m-publish-content\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}},[_vm._v(\"攻略正文 *\")]),_c('Tinymce',{attrs:{\"attachmentEnable\":true,\"resourceEnable\":true,\"height\":400},model:{value:(_vm.post.content),callback:function ($$v) {_vm.$set(_vm.post, \"content\", $$v)},expression:\"post.content\"}})],1),_c('div',{staticClass:\"m-publish-commit\"},[_c('el-divider',{attrs:{\"content-position\":\"left\"}}),_c('el-button',{staticClass:\"u-publish\",attrs:{\"icon\":\"el-icon-s-promotion\",\"type\":\"success\",\"disabled\":_vm.processing},on:{\"click\":_vm.toPublish}},[_vm._v(\"提交攻略 \")])],1)])],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <div class=\"m-publish-box\">\n    <!-- 头部 -->\n    <pubheader name=\"物品百科\">\n      <slot name=\"header\"></slot>\n    </pubheader>\n\n    <el-form class=\"m-publish-post\">\n      <div class=\"m-publish-source\">\n        <el-divider content-position=\"left\">选择物品 *</el-divider>\n        <el-select\n            class=\"u-source-id\"\n            v-model=\"post.source_id\"\n            filterable\n            remote\n            :disabled=\"!!post.id\"\n            placeholder=\"输入物品名称/物品描述并按『回车』进行搜索\"\n            :remote-method=\"goto_search_items\"\n            :loading=\"options.search_loading\"\n        >\n          <el-option v-for=\"item in options.items\" :key=\"item.id\" :label=\"item.Name\" :value=\"item.id\">\n            <div class=\"m-selector-item\">\n              <img class=\"u-icon\" :src=\"icon_url_filter(item.IconID)\" :alt=\"item.Name\"/>\n              <span class=\"u-name\" v-text=\"item.Name\"></span>\n            </div>\n          </el-option>\n        </el-select>\n      </div>\n\n      <div class=\"m-publish-level\">\n        <el-divider content-position=\"left\">综合难度 *</el-divider>\n        <el-rate v-model=\"post.level\" class=\"u-level\"></el-rate>\n      </div>\n\n      <div class=\"m-publish-remark\">\n        <el-divider content-position=\"left\">修订说明 *</el-divider>\n        <el-input v-model=\"post.remark\" placeholder=\"请简单描述一下本次修订的说明\"></el-input>\n      </div>\n\n      <div class=\"m-publish-content\">\n        <el-divider content-position=\"left\">攻略正文 *</el-divider>\n        <Tinymce\n            v-model=\"post.content\"\n            :attachmentEnable=\"true\"\n            :resourceEnable=\"true\"\n            :height=\"400\"\n        />\n      </div>\n\n      <div class=\"m-publish-commit\">\n        <el-divider content-position=\"left\"></el-divider>\n        <el-button\n            class=\"u-publish\"\n            icon=\"el-icon-s-promotion\"\n            type=\"success\"\n            @click=\"toPublish\"\n            :disabled=\"processing\"\n        >提交攻略\n        </el-button>\n      </div>\n    </el-form>\n  </div>\n</template>\n\n<script>\n  import pubheader from \"@/components/publish/pubheader.vue\";\n  import Tinymce from '@jx3box/jx3box-editor/src/Tinymce'\n\n  // 本地依赖\n  import {JX3BOX} from \"@jx3box/jx3box-common\";\n  import {search_items, get_item_newest_post} from \"../service/item\";\n  import {create_post} from \"../service/wiki_post\";\n  import User from \"@jx3box/jx3box-common/js/user\";\n\n  export default {\n    name: \"item\",\n    props: [],\n    data: function () {\n      return {\n        //选项 - 加载可选项\n        options: {\n          items: null,\n          search_loading: false,\n        },\n\n        //文章 - 主表数据\n        post: {\n          id: \"\",     // 文章ID\n          content: \"\",\n          source_id: \"\",\n          level: 0,\n          remark: \"\",\n        },\n      };\n    },\n    computed: {\n      processing: function () {\n        return this.$store.state.processing\n      }\n    },\n    methods: {\n      toPublish: function () {\n        if (!this.post.source_id) {\n          this.$message({message: \"请选择要修订攻略的物品\", type: \"warning\"});\n          return;\n        }\n\n        if (!this.post.content) {\n          this.$message({message: \"要编写攻略正文哦\", type: \"warning\"});\n          return;\n        }\n\n        if (!(this.post.level >= 1 && this.post.level <= 5)) {\n          this.$message({message: \"请选择适合的综合难度\", type: \"warning\"});\n          return;\n        }\n\n        if (!this.post.remark) {\n          this.$message({message: \"请简单描述本次修订说明\", type: \"warning\"});\n          return;\n        }\n\n        this.$store.commit('startProcess');\n        create_post({\n          type: 'item',\n          source_id: this.post.source_id,\n          level: this.post.level,\n          user_nickname: User.getInfo().name,\n          content: this.post.content,\n          remark: this.post.remark,\n        }).then((data) => {\n          data = data.data;\n          if (data.code === 200) {\n            this.$message({message: \"提交成功，请等待审核\", type: \"success\"});\n            location.href = JX3BOX.__Root + 'dashboard/#/wiki';\n          } else {\n            this.$message({message: `${data.message}`, type: \"warning\",});\n          }\n        });\n      },\n      icon_url_filter(icon_id) {\n        if (isNaN(parseInt(icon_id))) {\n          return `${JX3BOX.__imgPath}image/common/nullicon.png`;\n        } else {\n          return `${JX3BOX.__iconPath}icon/${icon_id}.png`;\n        }\n      },\n      // 物品搜索\n      goto_search_items(keyword = '', callback = null) {\n        this.options.search_loading = true;\n        search_items(keyword, 10).then(\n            (data) => {\n              data = data.data;\n              this.options.items = data.code === 200 ? data.data.data : false;\n              this.options.search_loading = false;\n              if (typeof callback === \"function\") callback();\n            },\n            () => {\n              this.options.items = false;\n            }\n        );\n      },\n    },\n    mounted() {\n      this.goto_search_items('', () => {\n        // 获取物品ID并通过watch获取攻略\n        let id = this.$route.params.source_id;\n        this.post.source_id = id ? id : null;\n      });\n\n      // 去掉标题\n      document.getElementsByClassName(\"m-publish-title\").forEach((item) => {\n        item.remove();\n      });\n      // 去掉草稿\n      document.getElementsByClassName(\"el-button--plain\").forEach((item) => {\n        item.remove();\n      });\n    },\n    watch: {\n      \"post.source_id\": {\n        handler() {\n          if (!this.post.source_id) return;\n          get_item_newest_post(this.post.source_id)\n              .then((res) => {\n                let data = res.data;\n                if (data.code === 200) {\n                  // 数据填充\n                  let post = data.data.post;\n                  let item = data.data.source;\n\n                  if (post) {\n                    this.post.source_id = post.source_id;\n                    this.post.level = post.level || 1;\n                    this.post.remark = \"\";\n                    this.post.content = post.content;\n                  } else {\n                    this.post.source_id = this.post.source_id ? this.post.source_id : '';\n                    this.post.level = 0;\n                    this.post.remark = \"\";\n                    this.post.content = \"\";\n                  }\n\n                  if (item) {\n                    // 将选择项恢复至下拉框\n                    let exist = false;\n                    this.options.items = this.options.items || [];\n                    for (let index in this.options.items) {\n                      if (this.options.items[index].id == item.id) {\n                        exist = true;\n                        break;\n                      }\n                    }\n                    if (!exist) this.options.items.push(item);\n                  }\n                }\n              });\n        },\n      },\n    },\n    components: {\n      pubheader,\n      Tinymce,\n    },\n  };\n</script>\n\n<style lang=\"less\">\n  @import \"../assets/css/publish/item.less\";\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./item.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./item.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./item.vue?vue&type=template&id=b60d7f86&\"\nimport script from \"./item.vue?vue&type=script&lang=js&\"\nexport * from \"./item.vue?vue&type=script&lang=js&\"\nimport style0 from \"./item.vue?vue&type=style&index=0&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--10-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./item.vue?vue&type=style&index=0&lang=less&\"","import { $helper } from \"./axios\";\n\n// 物品搜索\nfunction search_items(keyword, length, fields, is_equip = null) {\n    let params = { keyword: keyword, limit: length, fields: fields };\n    if (is_equip !== null) params.is_equip = is_equip ? 1 : 0;\n\n    return $helper({\n        method: \"GET\",\n        url: `/api/item/search`,\n        params: params,\n    });\n}\n\nfunction get_item_newest_post(item_id) {\n    return $helper({\n        method: \"GET\",\n        url: `/api/wiki/post`,\n        params: { type: \"item\", source_id: item_id, supply: 0 },\n    });\n}\n\nexport { search_items, get_item_newest_post };\n","import { $helper } from \"./axios\";\nimport qs from \"qs\";\n\n// 获取最新攻略\nfunction get_newest_post(type, id) {\n    if (!id) return;\n    return $helper({\n        method: \"GET\",\n        url: `/api/wiki/post`,\n        params: { type: type, source_id: id },\n    });\n}\n\nfunction create_post(params) {\n    return $helper({\n        method: \"POST\",\n        url: `/api/wiki/post`,\n        data: qs.stringify({ post: params }),\n    });\n}\n\nexport { get_newest_post, create_post };\n","const JX3BOX = require(\"./data/jx3box\");\nconst SEO = require(\"./data/seo\");\n\nmodule.exports = { JX3BOX, SEO };\n"],"sourceRoot":""}
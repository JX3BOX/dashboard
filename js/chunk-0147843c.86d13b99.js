(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-0147843c"],{"0af9":function(t,e,s){"use strict";s("b480")},"498a":function(t,e,s){"use strict";var n=s("23e7"),o=s("58a8").trim,i=s("c8d2");n({target:"String",proto:!0,forced:i("trim")},{trim:function(){return o(this)}})},5899:function(t,e){t.exports="\t\n\v\f\r                　\u2028\u2029\ufeff"},"58a8":function(t,e,s){var n=s("1d80"),o=s("5899"),i="["+o+"]",a=RegExp("^"+i+i+"*"),r=RegExp(i+i+"*$"),c=function(t){return function(e){var s=String(n(e));return 1&t&&(s=s.replace(a,"")),2&t&&(s=s.replace(r,"")),s}};t.exports={start:c(1),end:c(2),trim:c(3)}},b480:function(t,e,s){},b52a:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"m-publish-box"},[s("pubheader",{attrs:{name:"通识百科"}},[t._t("header")],2),s("el-form",{staticClass:"m-publish-post"},[s("div",{staticClass:"m-publish-source"},[s("el-divider",{attrs:{"content-position":"left"}},[t._v("选择通识 *")]),s("el-select",{staticClass:"u-source-id",attrs:{filterable:"",remote:"",disabled:!!t.post.id,placeholder:"通过输入通识名称进行搜索","remote-method":t.search_handle,loading:t.options.loading},model:{value:t.post.source_id,callback:function(e){t.$set(t.post,"source_id",e)},expression:"post.source_id"}},t._l(t.options.sources,(function(e){return s("el-option",{key:e.id,attrs:{label:e.name,value:e.id}},[s("div",{staticClass:"u-option"},[s("span",{staticClass:"u-type",domProps:{textContent:t._s(e.label)}}),s("span",{staticClass:"u-name",domProps:{textContent:t._s(e.name)}})])])})),1),s("p",{staticClass:"m-knowledge-add"},[s("span",[t._v("如没有合适的通识选择，可点击此处")]),s("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(e){t.dialogVisible=!0}}},[t._v("添加通识")]),s("span",[t._v("Note：添加完成后的通识需要经过管理员审核通过后才会在通识百科上展示哦")])],1)],1),s("div",{staticClass:"m-publish-remark"},[s("el-divider",{attrs:{"content-position":"left"}},[t._v("修订说明 *")]),s("el-input",{attrs:{maxlength:200,minlength:1,"show-word-limit":"",required:"",placeholder:"请简单描述一下本次修订说明"},model:{value:t.post.remark,callback:function(e){t.$set(t.post,"remark",e)},expression:"post.remark"}})],1),s("div",{staticClass:"m-publish-content"},[s("el-divider",{attrs:{"content-position":"left"}},[t._v("通识正文 *")]),s("Tinymce",{attrs:{attachmentEnable:!0,resourceEnable:!0,height:600},model:{value:t.post.content,callback:function(e){t.$set(t.post,"content",e)},expression:"post.content"}})],1),s("div",{staticClass:"m-publish-tags"},[s("el-divider",{attrs:{"content-position":"left"}},[t._v("通识标签")]),t._l(t.post.tags,(function(e,n){return s("el-tag",{key:n,attrs:{closable:"","disable-transitions":!1},on:{close:function(e){return t.post.tags.splice(n,1)}}},[t._v(t._s(e)+" ")])})),t.inputVisible?s("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small",placeholder:"回车以添加"},on:{blur:t.handleInputConfirm},nativeOn:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.handleInputConfirm(e)}},model:{value:t.inputValue,callback:function(e){t.inputValue=e},expression:"inputValue"}}):s("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:t.showInput}},[t._v("+ 添加标签 ")])],2),s("div",{staticClass:"m-publish-commit"},[s("el-divider",{attrs:{"content-position":"left"}}),s("el-button",{staticClass:"u-publish",attrs:{icon:"el-icon-s-promotion",type:"primary",disabled:t.processing},on:{click:t.publish}},[t._v("提交通识 ")])],1)]),s("el-dialog",{attrs:{title:"通识添加",visible:t.dialogVisible,width:"640px"},on:{"update:visible":function(e){t.dialogVisible=e},open:function(e){t.knowledge={type:"",name:""}}}},[t.knowledge?s("el-form",{staticClass:"m-publish-knowledge"},[s("div",{staticClass:"m-publish-type"},[s("el-divider",{attrs:{"content-position":"left"}},[t._v("类别 *")]),t.types?s("el-radio-group",{model:{value:t.knowledge.type,callback:function(e){t.$set(t.knowledge,"type",e)},expression:"knowledge.type"}},t._l(t.types,(function(e,n){return s("el-radio",{key:e.name,attrs:{label:n,border:""}},[t._v(t._s(e.label)+" ")])})),1):t._e()],1),s("div",{staticClass:"m-publish-name"},[s("el-divider",{attrs:{"content-position":"left"}},[t._v("名称 *")]),s("el-input",{attrs:{placeholder:"请输入通识名称",minlength:1,maxlength:50,"show-word-limit":""},model:{value:t.knowledge.name,callback:function(e){t.$set(t.knowledge,"name",e)},expression:"knowledge.name"}})],1)]):t._e(),s("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[s("el-button",{on:{click:function(e){t.dialogVisible=!1}}},[t._v("取消")]),s("el-button",{attrs:{type:"primary",disabled:t.processing},on:{click:t.create_knowledge}},[t._v("添加通识")])],1)],1)],1)},o=[],i=(s("d3b7"),s("b0c0"),s("498a"),s("a0fa")),a=s("221a"),r=s("c9d2"),c=s("2777"),l=s("4328"),u=s.n(l);function d(){return Object(c["a"])({method:"GET",url:"/api/knowledge/menus"})}function p(t){return Object(c["a"])({method:"GET",url:"/api/knowledges",params:t})}function m(t){return Object(c["a"])({method:"POST",url:"/api/knowledge",data:u.a.stringify({knowledge:t})})}var f=s("e818"),h=s("65c2"),g={name:"knowledge",data:function(){return{dialogVisible:!1,knowledge:null,post:{id:"",content:"",source_id:"",remark:"",tags:[]},types:null,options:{sources:null,loading:!1},inputVisible:!1,inputValue:""}},computed:{processing:function(){return this.$store.state.processing}},methods:{create_knowledge:function(){var t=this;this.$store.commit("startProcess"),m({type:this.knowledge.type,name:this.knowledge.name}).then((function(e){e=e.data,200===e.code?(t.post.source_id=e.data.id,t.$message({message:"通识添加成功",type:"success"}),t.dialogVisible=!1):t.$message({message:"".concat(e.message),type:"warning"})})).finally((function(){t.$store.commit("endProcess")}))},search_handle:function(t){var e=this;this.options.loading=!0,p({keyword:t,include_pending:1,limit:10}).then((function(t){t=t.data,200===t.code&&(e.options.sources=t.data.data),e.options.loading=!1}))},validate:function(){var t=this,e=["source_id","content","remark"].every((function(e){return!!t.post[e]}));return e||this.$message.error("请完成必填项"),e},publish:function(){var t=this;this.validate()&&(this.$store.commit("startProcess"),Object(f["a"])({type:"knowledge",source_id:this.post.source_id,user_nickname:r["a"].getInfo().name,content:this.post.content,remark:this.post.remark,tags:this.post.tags}).then((function(e){e=e.data,200===e.code?t.$message({message:"提交成功，请等待审核",type:"success",onClose:function(){location.href=h["__Root"]+"/dashboard/#/wiki"}}):(t.$message({message:"".concat(e.message),type:"warning"}),t.$store.commit("endProcess"))})).catch((function(){t.$store.commit("endProcess")})))},showInput:function(){var t=this;this.inputVisible=!0,this.$nextTick((function(e){t.$refs.saveTagInput.$refs.input.focus()}))},handleInputConfirm:function(){var t=this.inputValue.trim();t&&this.post.tags.push(t),this.inputVisible=!1,this.inputValue=""}},created:function(){var t=this,e=this.$route.params.source_id;this.post.source_id=e||"",this.search_handle(""),d().then((function(e){e=e.data,200===e.code&&(t.types=e.data.menus)}))},components:{pubheader:i["a"],Tinymce:a["a"]},watch:{"post.source_id":{handler:function(){var t=this;this.post.source_id&&Object(f["b"])("knowledge",this.post.source_id).then((function(e){var s=e.data;if(200===s.code){var n=s.data.post,o=s.data.source;if(n?(t.post.source_id=parseInt(n.source_id),t.post.remark="",t.post.content=n.content,t.post.tags=n.tags||[]):(t.post.source_id=t.post.source_id?parseInt(t.post.source_id):"",t.post.remark="",t.post.content="",t.post.tags=[]),o){var i=!1;for(var a in t.options.sources=t.options.sources||[],t.options.sources)if(t.options.sources[a].id==o.id){i=!0;break}i||t.options.sources.push(o)}}}))}}}},b=g,v=(s("0af9"),s("2877")),k=Object(v["a"])(b,n,o,!1,null,null,null);e["default"]=k.exports},c8d2:function(t,e,s){var n=s("d039"),o=s("5899"),i="​᠎";t.exports=function(t){return n((function(){return!!o[t]()||i[t]()!=i||o[t].name!==t}))}},e818:function(t,e,s){"use strict";s.d(e,"b",(function(){return a})),s.d(e,"a",(function(){return r}));var n=s("2777"),o=s("4328"),i=s.n(o);function a(t,e){if(e)return Object(n["e"])({method:"GET",url:"/api/wiki/post",params:{type:t,source_id:e}})}function r(t){return Object(n["e"])({method:"POST",url:"/api/wiki/post",data:i.a.stringify({post:t})})}}}]);
//# sourceMappingURL=chunk-0147843c.86d13b99.js.map
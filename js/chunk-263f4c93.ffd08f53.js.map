{"version":3,"sources":["webpack:///./src/utils/emotion.js","webpack:///./src/service/msg.js","webpack:///./src/components/uc.vue?1aec","webpack:///./src/components/uc.vue","webpack:///./src/components/tabs.vue","webpack:///src/components/tabs.vue","webpack:///./src/components/tabs.vue?55f4","webpack:///./src/components/tabs.vue?b057","webpack:///src/components/uc.vue","webpack:///./src/components/uc.vue?375a","webpack:///./src/components/uc.vue?cd4f","webpack:///./src/views/letter.vue","webpack:///./src/components/letter/contacts.vue","webpack:///./src/service/letter.js","webpack:///src/components/letter/contacts.vue","webpack:///./src/components/letter/contacts.vue?9336","webpack:///./src/components/letter/contacts.vue?f6fc","webpack:///./src/components/letter/list.vue","webpack:///./src/components/letter/send_box.vue","webpack:///./src/components/letter/send_tools.vue","webpack:///src/components/letter/send_tools.vue","webpack:///./src/components/letter/send_tools.vue?1f31","webpack:///./src/components/letter/send_tools.vue?2332","webpack:///src/components/letter/send_box.vue","webpack:///./src/components/letter/send_box.vue?1b3d","webpack:///./src/components/letter/send_box.vue?cb3a","webpack:///src/components/letter/list.vue","webpack:///./src/components/letter/list.vue?797f","webpack:///./src/components/letter/list.vue?15f0","webpack:///src/views/letter.vue","webpack:///./src/views/letter.vue?20bc","webpack:///./src/views/letter.vue?f993","webpack:///./src/views/letter.vue?ee06","webpack:///./src/assets/img/null.png"],"names":["formatContent","_x","_formatContent","apply","arguments","_asyncToGenerator","_regeneratorRuntime","mark","_callee","val","ins","wrap","_context","prev","next","JX3_EMOTION","_renderHTML","abrupt","sent","stop","getMsgs","params","$next","get","readMsg","id","put","concat","readAll","removeMsg","delete","getMessageUnread","mute","getLetterUnread","getCommentMsgDetail","render","_vm","this","_c","_self","staticClass","class","icon","_v","_s","title","_t","attrs","tabList","msgChangeCount","staticRenderFns","on","changeTab","model","value","active","callback","$$v","expression","_l","tabs","item","key","name","slot","label","showCount","count","countMap","_e","props","type","Array","default","Number","data","msg","letter","message","watch","$route","routeName","immediate","handler","num","computed","includes","methods","$router","push","loadCount","_this","then","res","_res$data","_res$data$data","unread_count","mounted","components","component","String","profileTab","hasData","total_limit","ref","canOp","updateContact","checkContacts","contact","letterUpdateContact","emptyPng","directives","rawName","loading","contacts","index","receiver_info","$event","onContactClick","stopPropagation","removeContact","showAvatar","avatar","display_name","latest_letter","content_type","content","getConfig","$cms","createRecentContact","uid","post","getRecentContacts","deleteRecentContact","sendLetter","send_uid","receive_uid","getLetterList","query","getLetterListBefore","Boolean","emits","isInit","find","$emit","deep","receiver","addContact","getContacts","_this2","_this3","_this3$contacts","_res$data2","_res$data2$data$","_res$data2$data$$rece","length","finally","_item$receiver_info","_this4","_this4$contacts","filter","hasHistory","getHistory","historyFetched","historyFetching","historyError","letters","showTime","created_at","letterItemClass","link","letterBelong","domProps","lettersTrans","resolveImagePath","newMessage","toBottom","send","disabled","sendImage","updateText","nativeOn","indexOf","_k","keyCode","ctrlKey","over","isOver","currentSum","max","select","upload","emotionSelect","Emotion","maxSize","fileInput","$refs","uploadInput","dispatchEvent","MouseEvent","bubbles","cancelable","view","window","file","files","size","$message","error","formData","FormData","append","sendTools","user","User","getInfo","isLogin","clear","image","myField","startPos","endPos","document","querySelector","selectionStart","selectionEnd","substring","$nextTick","focus","setSelectionRange","sendBox","Object","peoples","firstId","lastId","limit","timer","_this$contact","_this$contact$receive","letterList","oldVal","_val$receiver_info","_oldVal$receiver_info","loadLetter","clearInterval","cycleLoad","isArray","forEach","beforeDestroy","DOMPurify","sanitize","nl2br","$set","str","replace","scrollTop","scrollHeight","begin","sender_info","_res$data$data2","_this4$letters","_this4$letters$","uniqBy","_this5","setInterval","_this6","_res$data$data3","_res$data$data$letter","_this6$letters$","_toConsumableArray","catch","err","sender","_this$peoples$id","_this$peoples$id2","authorLink","last","lastTime","Date","getTime","thisTime","_this7","_this7$$refs$sendBox","uc","contactList","msgTab","info","user_avatar","user_avatar_frame","bio","sign","experience","require","userLevel","_this$info","getLevel","loadUserInfo","loadConf","cloneDeep","_this$$refs$contacts","getMyInfo","module","exports"],"mappings":"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","file":"js/chunk-263f4c93.ffd08f53.js","sourcesContent":["import JX3_EMOTION from \"@jx3box/jx3box-emotion\";\n\nasync function formatContent(val) {\n    const ins = new JX3_EMOTION(val);\n    return await ins._renderHTML();\n}\n\nexport { formatContent };\n","import { $next } from \"@jx3box/jx3box-common/js/https\";\n\nfunction getMsgs(params) {\n    return $next().get(`/api/next2/userdata/messages`, { params });\n}\n\nfunction readMsg(id) {\n    return $next().put(`/api/next2/userdata/messages/read/${id}`);\n}\n\nfunction readAll() {\n    return $next().put(`/api/next2/userdata/messages/read`);\n}\n\nfunction removeMsg(id) {\n    return $next().delete(`/api/next2/userdata/messages/${id}`);\n}\n\nfunction getMessageUnread() {\n    return $next({ mute: true }).get(\"/api/next2/userdata/messages/unread_total\");\n}\n\nfunction getLetterUnread() {\n    return $next({ mute: true }).get(\"/api/letter/unread/count\");\n}\n\nfunction getCommentMsgDetail(id) {\n    return $next().get(`/api/next2/comment/item/${id}`);\n}\n\nexport { getMsgs, readMsg, readAll, removeMsg, getLetterUnread, getCommentMsgDetail, getMessageUnread };\n","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./uc.vue?vue&type=style&index=0&id=58434bd0&prod&lang=less\"","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"m-dashboard-profile m-profile\"},[_c('h2',{staticClass:\"u-title\"},[_c('i',{class:_vm.icon}),_vm._v(\" \"+_vm._s(_vm.title)+\" \"),_vm._t(\"header\")],2),_c('tabs',{attrs:{\"tabs\":_vm.tabList,\"msg-change-count\":_vm.msgChangeCount}}),_vm._t(\"default\")],2)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('el-tabs',{staticClass:\"m-dashboard-tabs\",on:{\"tab-click\":_vm.changeTab},model:{value:(_vm.active),callback:function ($$v) {_vm.active=$$v},expression:\"active\"}},_vm._l((_vm.tabs),function(item){return _c('el-tab-pane',{key:item.name,attrs:{\"name\":item.name}},[_c('span',{attrs:{\"slot\":\"label\"},slot:\"label\"},[_c('i',{staticClass:\"u-tab-icon\",class:item.icon}),_vm._v(\" \"+_vm._s(item.label)+\" \"),(_vm.showCount)?_c('span',{staticClass:\"u-count\",class:_vm.count[_vm.countMap[item.name]] ? 'is-orange' : ''},[_vm._v(\"(\"+_vm._s(_vm.count[_vm.countMap[item.name]] || 0)+\")\")]):_vm._e()])])}),1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n    <el-tabs class=\"m-dashboard-tabs\" v-model=\"active\" @tab-click=\"changeTab\">\n        <el-tab-pane v-for=\"item in tabs\" :key=\"item.name\" :name=\"item.name\">\n            <span slot=\"label\"\n                ><i :class=\"item.icon\" class=\"u-tab-icon\"></i> {{ item.label }}\n                <span v-if=\"showCount\" class=\"u-count\" :class=\"count[countMap[item.name]] ? 'is-orange' : ''\"\n                    >({{ count[countMap[item.name]] || 0 }})</span\n                >\n            </span>\n        </el-tab-pane>\n    </el-tabs>\n</template>\n\n<script>\nimport { getLetterUnread, getMessageUnread } from \"@/service/msg\";\nexport default {\n    name: \"\",\n    props: {\n        tabs: {\n            type: Array,\n            default: () => [],\n        },\n        msgChangeCount: {\n            type: Number,\n            default: 0,\n        },\n    },\n    data: function () {\n        return {\n            active: \"\",\n            countMap: {\n                msg: \"message\",\n                letter: \"letter\",\n            },\n            count: {\n                message: 0,\n                letter: 0,\n            },\n        };\n    },\n    watch: {\n        $route: function () {\n            this.active = this.routeName;\n        },\n        msgChangeCount: {\n            immediate: true,\n            handler(num) {\n                if (num > 0) {\n                    // 全读\n                    this.count.message = 0;\n                }\n                if (num < 0) {\n                    // 单个已读\n                    if (this.count.message > 0) {\n                        this.count.message += num;\n                    }\n                }\n            },\n        },\n    },\n    computed: {\n        showCount() {\n            return [\"msg\", \"letter\"].includes(this.routeName);\n        },\n        routeName() {\n            return this.$route.name;\n        },\n    },\n    methods: {\n        changeTab: function () {\n            this.$router.push({ name: this.active });\n        },\n        loadCount() {\n            getLetterUnread().then((res) => {\n                const data = res.data?.data || {};\n                this.count.letter = data.letter || 0;\n            });\n\n            getMessageUnread().then((res) => {\n                this.count.message = res.data.data?.unread_count || 0;\n            })\n        },\n    },\n    mounted: function () {\n        this.active = this.routeName;\n        if (this.showCount) {\n            this.loadCount();\n        }\n    },\n    components: {},\n};\n</script>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./tabs.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./tabs.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./tabs.vue?vue&type=template&id=3877b214\"\nimport script from \"./tabs.vue?vue&type=script&lang=js\"\nexport * from \"./tabs.vue?vue&type=script&lang=js\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<template>\n    <div class=\"m-dashboard-profile m-profile\">\n        <h2 class=\"u-title\">\n            <i :class=\"icon\"></i> {{ title }}\n            <slot name=\"header\"></slot>\n        </h2>\n        <tabs :tabs=\"tabList\" :msg-change-count=\"msgChangeCount\" />\n        <slot></slot>\n    </div>\n</template>\n\n<script>\nimport tabs from \"@/components/tabs.vue\";\nimport { profileTab } from \"@/assets/data/tabs.json\";\nexport default {\n    name: \"uc\",\n    props: {\n        icon: {\n            type: String,\n            default: \"el-icon-user\",\n        },\n        title: {\n            type: String,\n            default: \"我的资料\",\n        },\n        tabList: {\n            type: Array,\n            default: function () {\n                return profileTab;\n            },\n        },\n        msgChangeCount: {\n            type: Number,\n            default: 0,\n        },\n    },\n    data: function () {\n        return {};\n    },\n    computed: {},\n    methods: {},\n    mounted: function () {},\n    components: {\n        tabs,\n    },\n};\n</script>\n\n<style lang=\"less\">\n@import \"../assets/css/profile/uc.less\";\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./uc.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./uc.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./uc.vue?vue&type=template&id=58434bd0\"\nimport script from \"./uc.vue?vue&type=script&lang=js\"\nexport * from \"./uc.vue?vue&type=script&lang=js\"\nimport style0 from \"./uc.vue?vue&type=style&index=0&id=58434bd0&prod&lang=less\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('uc',{staticClass:\"m-dashboard-frame m-dashboard-skin\",attrs:{\"icon\":\"el-icon-bell\",\"title\":\"我的消息\",\"tab-list\":_vm.tabList}},[(_vm.hasData)?_c('div',{staticClass:\"m-dashboard-letter\"},[_c('div',{staticClass:\"m-dashboard-letter__left\"},[_c('div',{staticClass:\"u-title\"},[_vm._v(\"近期消息 \"),_c('span',{staticClass:\"u-limit\"},[_vm._v(\"每日上限\"+_vm._s(_vm.total_limit)+\"条\")])]),_c('contact-list',{ref:\"contacts\",attrs:{\"can-op\":_vm.canOp},on:{\"update:contact\":_vm.updateContact,\"check:contacts\":_vm.checkContacts}})],1),_c('div',{staticClass:\"m-dashboard-letter__right\"},[_c('letter-list',{attrs:{\"contact\":_vm.contact,\"can-op\":_vm.canOp},on:{\"update:contact\":_vm.letterUpdateContact}})],1)]):_c('div',{staticClass:\"u-null\"},[_c('el-empty',{attrs:{\"image\":_vm.emptyPng,\"description\":\"这里什么都没有呢~\"}})],1)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],staticClass:\"m-letter-contacts\"},_vm._l((_vm.contacts),function(item,index){return _c('div',{key:index,staticClass:\"m-letter-contact\",class:{ active: _vm.active == item.receiver_info.id },on:{\"click\":function($event){return _vm.onContactClick(item)}}},[(item.receiver_info.id != 0 && _vm.canOp)?_c('div',{staticClass:\"u-close\",attrs:{\"title\":\"移除\"},on:{\"click\":function($event){$event.stopPropagation();return _vm.removeContact(item)}}},[_c('i',{staticClass:\"el-icon-close\"})]):_vm._e(),_c('img',{staticClass:\"u-avatar\",attrs:{\"src\":_vm.showAvatar(item.receiver_info.avatar),\"alt\":\"\"}}),_c('div',{staticClass:\"m-user\"},[_c('div',{staticClass:\"u-user-name\",attrs:{\"title\":item.receiver_info.display_name}},[_vm._v(\" \"+_vm._s(item.receiver_info.display_name)+\" \")]),(item.latest_letter)?_c('div',{staticClass:\"u-latest-chat\"},[_vm._v(\" \"+_vm._s(item.latest_letter.content_type ? `[图片]` : item.latest_letter.content)+\" \")]):_vm._e()])])}),0)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { $next,$cms } from \"@jx3box/jx3box-common/js/https\";\n\nexport function getConfig(params) {\n    return $cms({ mute: true }).get(\"/api/cms/config\",{\n        params\n    });\n}\n\n/**\n * 新建最新联系人\n * @param {number} uid\n * @returns\n */\nexport function createRecentContact(uid) {\n    return $next().post(`/api/letter/recently/contacts/${uid}`);\n}\n\n// 获取最近联系人\nexport function getRecentContacts() {\n    return $next().get(`/api/letter/recently/contacts`);\n}\n\n/**\n * 删除最近联系人\n * @param {number} uid\n * @returns\n */\nexport function deleteRecentContact(uid) {\n    return $next().delete(`/api/letter/recently/contacts/${uid}`);\n}\n\n/**\n * 发送私信\n * @param {number} send_uid 发送方uid\n * @param {number} receive_uid 接收方uid\n * @param {string} data.content 消息内容\n * @param {string} data.content_type 消息类型 0 文本 1 图片\n */\nexport function sendLetter(send_uid, receive_uid, data) {\n    return $next().post(`/api/letter/${send_uid}/to/${receive_uid}`, data);\n}\n\n/**\n * 获取与某人的聊天记录 - 某条消息之后的消息\n * @param {number} send_uid 发送方uid\n * @param {number} receive_uid 接收方uid\n * @param {number} query.begin 上次消息的id\n * @param {number} query.limit 拉取消息的数量\n */\nexport function getLetterList(send_uid, receive_uid, query) {\n    return $next().get(`/api/letter/${send_uid}/to/${receive_uid}/newest`, {\n        params: query,\n    });\n}\n\n// 获取与某人的聊天记录 - 某条消息之前的消息\nexport function getLetterListBefore(send_uid, receive_uid, query) {\n    return $next().get(`/api/letter/${send_uid}/to/${receive_uid}/before`, {\n        params: query,\n    });\n}\n\n// 获取未读私信数量\nexport function getUnreadLetterCount() {\n    return $next().get(`/api/letter/unread/count`);\n}\n","<template>\n    <div class=\"m-letter-contacts\" v-loading=\"loading\">\n        <div\n            class=\"m-letter-contact\"\n            v-for=\"(item, index) in contacts\"\n            :key=\"index\"\n            :class=\"{ active: active == item.receiver_info.id }\"\n            @click=\"onContactClick(item)\"\n        >\n            <div class=\"u-close\" @click.stop=\"removeContact(item)\" title=\"移除\" v-if=\"item.receiver_info.id != 0 && canOp\">\n                <i class=\"el-icon-close\"></i>\n            </div>\n            <img class=\"u-avatar\" :src=\"showAvatar(item.receiver_info.avatar)\" alt=\"\" />\n\n            <div class=\"m-user\">\n                <div class=\"u-user-name\" :title=\"item.receiver_info.display_name\">\n                    {{ item.receiver_info.display_name }}\n                </div>\n                <div class=\"u-latest-chat\" v-if=\"item.latest_letter\">\n                    {{ item.latest_letter.content_type ? `[图片]` : item.latest_letter.content }}\n                </div>\n            </div>\n        </div>\n    </div>\n</template>\n\n<script>\nimport { getRecentContacts, deleteRecentContact, createRecentContact } from \"@/service/letter\";\nimport { showAvatar } from \"@jx3box/jx3box-common/js/utils\";\nexport default {\n    name: \"contacts\",\n    props: {\n        canOp: {\n            type: Boolean,\n            default: false,\n        }\n    },\n    emits: [\"update:contact\", \"check:contacts\"],\n    data() {\n        return {\n            active: \"\",\n            loading: false,\n            isInit: true,\n            contacts: [],\n        };\n    },\n    watch: {\n        active: {\n            handler() {\n                const item = this.contacts.find((item) => item.receiver_info.id == this.active);\n                this.$emit(\"update:contact\", item);\n            },\n        },\n        \"$route.query\": {\n            deep: true,\n            immediate: true,\n            handler(val) {\n                if (val?.receiver) {\n                    this.addContact(val.receiver);\n                } else {\n                    this.getContacts();\n                }\n            },\n        },\n    },\n    methods: {\n        addContact(uid) {\n            if (!uid) return;\n            createRecentContact(uid).then((res) => {\n                this.getContacts();\n            });\n        },\n        getContacts() {\n            if (this.isInit) this.loading = true;\n            return getRecentContacts()\n                .then((res) => {\n                    this.contacts = res?.data?.data || [];\n\n                    this.$emit(\"check:contacts\", !!this.contacts?.length);\n\n                    if (!this.contacts.length) return;\n                    // 如果active不在联系人列表中，就默认选中第一个\n\n                    this.active = this.isInit ? res.data?.data[0]?.receiver_info?.id : this.active;\n\n                    this.isInit = false;\n\n                })\n                .finally(() => {\n                    this.loading = false;\n                });\n        },\n        removeContact(item) {\n            deleteRecentContact(item?.receiver_info?.id).then((res) => {\n                this.contacts = this.contacts.filter((contact) => contact.receiver_info.id != item.receiver_info.id);\n                if (this.active == item.receiver_info.id && this.contacts.length) {\n                    this.active = this.contacts[0].receiver_info.id;\n                }\n                this.$emit(\"check:contacts\", !!this.contacts?.length);\n            });\n        },\n        onContactClick(item) {\n            this.active = item.receiver_info.id;\n        },\n        showAvatar,\n    },\n};\n</script>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./contacts.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./contacts.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./contacts.vue?vue&type=template&id=78c8ec96\"\nimport script from \"./contacts.vue?vue&type=script&lang=js\"\nexport * from \"./contacts.vue?vue&type=script&lang=js\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","var render = function render(){var _vm=this,_c=_vm._self._c;return (_vm.contact)?_c('div',{staticClass:\"m-letter-box\"},[(_vm.hasData)?_c('div',{staticClass:\"u-chat-name\"},[_vm._v(_vm._s(_vm.contact.receiver_info.display_name))]):_vm._e(),_c('div',{directives:[{name:\"loading\",rawName:\"v-loading\",value:(_vm.loading),expression:\"loading\"}],ref:\"letterList\",staticClass:\"m-letter-list\",attrs:{\"element-loading-spinner\":\"el-icon-loading\"}},[_c('div',{staticClass:\"u-letter-more\"},[_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.hasHistory),expression:\"hasHistory\"}],staticClass:\"u-load-more\",on:{\"click\":function($event){$event.stopPropagation();return _vm.getHistory.apply(null, arguments)}}},[_c('i',{staticClass:\"el-icon-d-arrow-right u-more-icon\"}),_vm._v(\"查看历史消息\")]),_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.historyFetched && !_vm.hasHistory),expression:\"historyFetched && !hasHistory\"}],staticClass:\"u-no-more\"},[_vm._v(\"没有更多消息了~\")]),_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.historyFetching),expression:\"historyFetching\"}],staticClass:\"u-loading\"},[_c('i',{staticClass:\"el-icon-loading\"})]),_c('span',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.historyError),expression:\"historyError\"}],staticClass:\"u-error\"},[_vm._v(\" 消息加载失败，\"),_c('span',{staticClass:\"u-error__btn\",on:{\"click\":function($event){$event.stopPropagation();return _vm.getHistory.apply(null, arguments)}}},[_vm._v(\"点击重新加载\")])])]),_vm._l((_vm.letters),function(item,index){return _c('div',{key:item.id,staticClass:\"m-letter-list-content\"},[(_vm.showTime(item, index))?_c('div',{staticClass:\"u-time\"},[_vm._v(_vm._s(item.created_at))]):_vm._e(),_c('div',{staticClass:\"m-letter-item\",class:_vm.letterItemClass(item)},[_c('a',{staticClass:\"u-avatar\",attrs:{\"href\":_vm.link(item),\"target\":\"_blank\"}},[_c('img',{staticClass:\"u-img\",attrs:{\"src\":_vm.letterBelong(item),\"alt\":item.id}})]),_c('div',{staticClass:\"u-letter-content\"},[(item.content_type == 0)?_c('div',{staticClass:\"u-letter-text\",domProps:{\"innerHTML\":_vm._s(_vm.lettersTrans[item.content])}}):_vm._e(),(item.content_type == 1)?_c('div',{staticClass:\"u-letter-image\",attrs:{\"title\":\"点击查看大图\"}},[_c('el-image',{attrs:{\"src\":_vm.resolveImagePath(item.content),\"preview-src-list\":[item.content]}})],1):_vm._e()])])])})],2),_c('div',{directives:[{name:\"show\",rawName:\"v-show\",value:(_vm.newMessage),expression:\"newMessage\"}],staticClass:\"u-letter-new\"},[_c('div',{staticClass:\"u-text\",on:{\"click\":_vm.toBottom}},[_vm._v(\"您有新消息\")])]),_c('send-box',{ref:\"sendBox\",attrs:{\"disabled\":!_vm.canOp},on:{\"send\":_vm.send}})],1):_vm._e()\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"m-letter-sendbox\",class:{ disabled: _vm.disabled }},[_c('sendTools',{on:{\"update:image\":_vm.sendImage,\"update:text\":_vm.updateText}}),_c('div',{staticClass:\"u-send-content\"},[_c('el-input',{attrs:{\"type\":\"textarea\",\"placeholder\":\"按 Ctrl+Enter 可快速发送消息\",\"id\":\"letterInput\"},nativeOn:{\"keydown\":function($event){if(!$event.type.indexOf('key')&&_vm._k($event.keyCode,\"enter\",13,$event.key,\"Enter\"))return null;if(!$event.ctrlKey)return null;return _vm.send.apply(null, arguments)}},model:{value:(_vm.content),callback:function ($$v) {_vm.content=$$v},expression:\"content\"}})],1),_c('div',{staticClass:\"u-send-action\"},[_c('span',{staticClass:\"u-text-sum\"},[_c('span',{staticClass:\"u-current-sum\",class:{ over: _vm.isOver }},[_vm._v(_vm._s(_vm.currentSum))]),_c('span',{staticClass:\"u-max-sum\"},[_vm._v(\"/\"+_vm._s(_vm.max))])]),_c('el-button',{attrs:{\"size\":\"mini\",\"disabled\":_vm.isOver || !_vm.currentSum},on:{\"click\":_vm.send}},[_vm._v(\"发送\")])],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"m-send-tools\"},[_c('div',{staticClass:\"m-upload\"},[_c('i',{staticClass:\"el-icon-picture-outline u-upload-icon\",on:{\"click\":_vm.select}}),_c('input',{ref:\"uploadInput\",staticClass:\"u-upload-file\",attrs:{\"type\":\"file\",\"accept\":\".jpg, .jpeg, .png, .gif, .bmp,.webp\"},on:{\"change\":_vm.upload}})]),_c('Emotion',{attrs:{\"type\":\"pop\",\"max\":6},on:{\"selected\":_vm.emotionSelect}})],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n    <div class=\"m-send-tools\">\n        <div class=\"m-upload\">\n            <i class=\"el-icon-picture-outline u-upload-icon\" @click=\"select\"></i>\n            <input\n                class=\"u-upload-file\"\n                type=\"file\"\n                @change=\"upload\"\n                ref=\"uploadInput\"\n                accept=\".jpg, .jpeg, .png, .gif, .bmp,.webp\"\n            />\n        </div>\n        <Emotion type=\"pop\" @selected=\"emotionSelect\" :max=\"6\" />\n    </div>\n</template>\n\n<script>\nimport { upload } from \"@/service\";\nimport Emotion from \"@jx3box/jx3box-emotion/src/Emotion.vue\";\nexport default {\n    name: \"sendTools\",\n    components: {\n        Emotion,\n    },\n    emits: [\"update:image\", \"update:text\"],\n    data() {\n        return {\n            data: \"\",\n\n            maxSize: 10\n        }\n    },\n    computed: {\n        fileInput: function () {\n            return this.$refs.uploadInput;\n        },\n    },\n    methods: {\n        select() {\n            this.fileInput.dispatchEvent(\n                new MouseEvent(\"click\", {\n                    bubbles: true,\n                    cancelable: true,\n                    view: window,\n                })\n            );\n        },\n        upload() {\n            const file = this.fileInput.files[0];\n            if (!file) return;\n            if (file.size > this.maxSize * 1024 * 1024) {\n                this.$message.error(\"图片大小不能超过\" + this.maxSize + \"M\");\n                return;\n            }\n            const formData = new FormData();\n            formData.append(\"file\", file);\n            upload(formData).then((res) => {\n                this.data = res.data.data[0];\n                this.$emit(\"update:image\", this.data);\n            });\n        },\n        emotionSelect(data) {\n            this.$emit(\"update:text\", data.key);\n        },\n    }\n}\n</script>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./send_tools.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./send_tools.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./send_tools.vue?vue&type=template&id=5973aee0\"\nimport script from \"./send_tools.vue?vue&type=script&lang=js\"\nexport * from \"./send_tools.vue?vue&type=script&lang=js\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<template>\n    <div class=\"m-letter-sendbox\" :class=\"{ disabled: disabled }\">\n        <sendTools @update:image=\"sendImage\" @update:text=\"updateText\" />\n        <div class=\"u-send-content\">\n            <el-input type=\"textarea\" placeholder=\"按 Ctrl+Enter 可快速发送消息\" v-model=\"content\" id=\"letterInput\" @keydown.ctrl.enter.native=\"send\"></el-input>\n        </div>\n        <div class=\"u-send-action\">\n            <span class=\"u-text-sum\">\n                <span class=\"u-current-sum\" :class=\"{ over: isOver }\">{{ currentSum }}</span>\n                <span class=\"u-max-sum\">/{{ max }}</span>\n            </span>\n            <el-button size=\"mini\" :disabled=\"isOver || !currentSum\" @click=\"send\">发送</el-button>\n        </div>\n    </div>\n</template>\n\n<script>\nimport User from \"@jx3box/jx3box-common/js/user\";\nimport sendTools from \"./send_tools.vue\";\nexport default {\n    name: \"sendBox\",\n    props: {\n        disabled: {\n            type: Boolean,\n            default: false,\n        },\n    },\n    components: {\n        sendTools,\n    },\n    emits: [\"send\"],\n    data() {\n        return {\n            content: \"\",\n            max: 500,\n\n            user: User.getInfo(),\n\n            isLogin: User.isLogin(),\n        };\n    },\n    computed: {\n        currentSum() {\n            return this.content.length;\n        },\n        // 是否超过\n        isOver() {\n            return this.currentSum > this.max;\n        },\n    },\n    methods: {\n        // 发送\n        send() {\n            if (this.isOver || !this.currentSum) return;\n            this.$emit(\"send\", { content: this.content, content_type: 0 }); // 文本类型\n        },\n        clear() {\n            this.content = \"\";\n        },\n        sendImage(image) {\n            this.$emit(\"send\", { content: image, content_type: 1 }); // 图片类型\n        },\n        async updateText(key) {\n            const myField = document.querySelector(`#letterInput`);\n            const value = key\n            if (myField.selectionStart || myField.selectionStart === 0) {\n                let startPos = myField.selectionStart;\n                let endPos = myField.selectionEnd;\n\n                this.content =\n                    myField.value.substring(0, startPos) +\n                    value +\n                    myField.value.substring(endPos, myField.value.length);\n\n                await this.$nextTick();\n\n                myField.focus();\n                myField.setSelectionRange(\n                    endPos + value.length,\n                    endPos + value.length\n                );\n            } else {\n                this.content = value;\n            }\n        }\n    },\n};\n</script>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./send_box.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./send_box.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./send_box.vue?vue&type=template&id=11a41792\"\nimport script from \"./send_box.vue?vue&type=script&lang=js\"\nexport * from \"./send_box.vue?vue&type=script&lang=js\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<template>\n    <div v-if=\"contact\" class=\"m-letter-box\">\n        <div class=\"u-chat-name\" v-if=\"hasData\">{{ contact.receiver_info.display_name }}</div>\n        <div class=\"m-letter-list\" v-loading=\"loading\" element-loading-spinner=\"el-icon-loading\" ref=\"letterList\">\n            <div class=\"u-letter-more\">\n                <span class=\"u-load-more\" v-show=\"hasHistory\" @click.stop=\"getHistory\"\n                    ><i class=\"el-icon-d-arrow-right u-more-icon\"></i>查看历史消息</span\n                >\n                <span class=\"u-no-more\" v-show=\"historyFetched && !hasHistory\">没有更多消息了~</span>\n                <span class=\"u-loading\" v-show=\"historyFetching\"><i class=\"el-icon-loading\"></i></span>\n                <span class=\"u-error\" v-show=\"historyError\">\n                    消息加载失败，<span class=\"u-error__btn\" @click.stop=\"getHistory\">点击重新加载</span>\n                </span>\n            </div>\n            <div class=\"m-letter-list-content\" v-for=\"(item, index) in letters\" :key=\"item.id\">\n                <div class=\"u-time\" v-if=\"showTime(item, index)\">{{ item.created_at }}</div>\n                <div class=\"m-letter-item\" :class=\"letterItemClass(item)\">\n                    <a :href=\"link(item)\" class=\"u-avatar\" target=\"_blank\">\n                        <img :src=\"letterBelong(item)\" class=\"u-img\" :alt=\"item.id\" />\n                    </a>\n                    <div class=\"u-letter-content\">\n                        <div\n                            class=\"u-letter-text\"\n                            v-if=\"item.content_type == 0\"\n                            v-html=\"lettersTrans[item.content]\"\n                        ></div>\n                        <div class=\"u-letter-image\" v-if=\"item.content_type == 1\" title=\"点击查看大图\">\n                            <el-image\n                                :src=\"resolveImagePath(item.content)\"\n                                :preview-src-list=\"[item.content]\"\n                            ></el-image>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        </div>\n        <div class=\"u-letter-new\" v-show=\"newMessage\">\n            <div class=\"u-text\" @click=\"toBottom\">您有新消息</div>\n        </div>\n        <send-box @send=\"send\" ref=\"sendBox\" :disabled=\"!canOp\" />\n    </div>\n</template>\n\n<script>\n// api\nimport { getLetterList, sendLetter, getLetterListBefore } from \"@/service/letter\";\n// utils\nimport DOMPurify from \"dompurify\";\nimport User from \"@jx3box/jx3box-common/js/user\";\nimport { formatContent } from \"@/utils/emotion\";\nimport { showAvatar, authorLink, resolveImagePath } from \"@jx3box/jx3box-common/js/utils\";\nimport { uniqBy } from \"lodash\";\n// components\nimport sendBox from \"@/components/letter/send_box.vue\";\nexport default {\n    name: \"letterList\",\n    components: {\n        sendBox,\n    },\n    props: {\n        contact: {\n            type: Object,\n            default: () => ({}),\n        },\n        canOp: {\n            type: Boolean,\n            default: false,\n        },\n    },\n    emits: [\"update:contact\"],\n    data() {\n        return {\n            lettersTrans: {},\n            letters: [],\n            peoples: {},\n            user: User.getInfo(),\n            loading: false,\n            isInit: true, // 是否初始化\n\n            firstId: 0, // 第一条数据的id\n            lastId: 0, // 最后一条数据的id\n            limit: 10, // 每次获取的数据条数\n            timer: null, // 循环获取数据的定时器\n            hasHistory: true, // 是否有历史消息\n            historyFetched: false, // 是否已经获取过历史消息\n            historyFetching: false, // 是否正在获取历史消息\n            historyError: false, // 历史消息获取失败\n\n            newMessage: false, // 是否有新消息\n        };\n    },\n    computed: {\n        hasData() {\n            return !!this.contact?.receiver_info?.id;\n        },\n        letterList() {\n            return this.$refs.letterList;\n        },\n    },\n    watch: {\n        contact: {\n            deep: true,\n            immediate: true,\n            handler(val, oldVal) {\n                if (val?.receiver_info?.id !== oldVal?.receiver_info?.id) {\n                    this.letters = [];\n                    this.peoples = {};\n                    this.firstId = 0;\n                    this.lastId = 0;\n                    this.hasHistory = false;\n                }\n                this.isInit = true;\n                this.loadLetter();\n                clearInterval(this.timer);\n                this.cycleLoad();\n            },\n        },\n        letters: {\n            deep: true,\n            handler(val) {\n                if (Array.isArray(val) && val.length > 0) {\n                    val.filter((item) => item.content_type === 0).forEach((item) => {\n                        this.formatContent(item.content);\n                    });\n                }\n            },\n        },\n    },\n    beforeDestroy() {\n        clearInterval(this.timer);\n    },\n    methods: {\n        resolveImagePath,\n        formatContent(content) {\n            content = DOMPurify.sanitize(content);\n            formatContent(this.nl2br(content)).then((res) => {\n                this.$set(this.lettersTrans, content, res);\n            });\n        },\n        nl2br(str) {\n            return str.replace(/\\n/g, \"<br>\");\n        },\n        toBottom() {\n            this.newMessage = false;\n            this.$nextTick(() => {\n                const letterList = this.letterList;\n                letterList && (letterList.scrollTop = letterList.scrollHeight);\n            });\n        },\n        loadLetter(mute = true) {\n            if (!this.hasData) return;\n            if (this.isInit) this.loading = true;\n            const params = {\n                begin: this.lastId,\n                limit: this.limit,\n            };\n            return getLetterList(this.contact.sender_info.id, this.contact.receiver_info.id, params)\n                .then((res) => {\n                    this.letters = uniqBy(this.letters.concat(res.data.data?.letters || []), \"id\");\n                    this.peoples = res.data.data?.peoples || {};\n                    this.lastId = this.letters[this.letters.length - 1]?.id || this.lastId;\n                    this.firstId = this.letters[0]?.id || this.firstId;\n                    // 如果letters的长度小于limit，说明没有更多数据了\n                    this.hasHistory = !(this.letters.length < this.limit);\n\n                    this.$nextTick(() => {\n                        if (this.isInit) {\n                            if (this.letterList) {\n                                this.letterList.scrollTop = this.letterList.scrollHeight;\n                            }\n                        }\n                    });\n                    this.isInit = false;\n\n                    // 如果有新消息，并且滚动条没有到底，设置newMessage为true\n                    /* if (res.data.data?.letters?.length > 0 && this.lastId && mute) { // lastId为0说明是第一次加载\n                    const letterList = this.letterList;\n                    if (letterList && letterList.scrollTop < letterList.scrollHeight - letterList.clientHeight) {\n                        this.newMessage = true;\n                    }\n                } */\n                })\n                .finally(() => {\n                    this.loading = false;\n                });\n        },\n        // 循环获取最新的数据\n        cycleLoad() {\n            this.timer = setInterval(() => {\n                this.loadLetter();\n                this.$emit(\"update:contact\");\n            }, 15000);\n        },\n        getHistory() {\n            this.historyFetching = true;\n            this.hasHistory = false;\n            const params = {\n                begin: this.firstId,\n                limit: this.limit,\n            };\n            getLetterListBefore(this.contact.sender_info.id, this.contact.receiver_info.id, params)\n                .then((res) => {\n                    this.letters = uniqBy([...(res.data.data?.letters || []), ...this.letters], \"id\");\n                    this.hasHistory = !(res.data.data.letters?.length < this.limit);\n                    this.firstId = this.letters[0]?.id || this.firstId;\n\n                    this.historyFetched = true;\n                    this.historyFetching = false;\n                    this.historyError = false;\n                })\n                .catch((err) => {\n                    this.historyFetched = true;\n                    this.historyFetching = false;\n                    this.historyError = true;\n                });\n        },\n        letterItemClass(item) {\n            if (item.sender == this.user.uid) {\n                return \"me\";\n            } else {\n                return \"not-me\";\n            }\n        },\n        letterBelong(letter) {\n            const id = letter.sender == this.user.uid ? this.user.uid : letter.sender;\n            return showAvatar(this.peoples[id]?.avatar);\n        },\n        link(letter) {\n            const id = letter.sender == this.user.uid ? this.user.uid : letter.sender;\n            return authorLink(this.peoples[id]?.id);\n        },\n        showTime(item, index) {\n            if (index == 0) {\n                return true;\n            }\n            const last = this.letters[index - 1];\n            const lastTime = new Date(last.created_at).getTime();\n            const thisTime = new Date(item.created_at).getTime();\n            return thisTime - lastTime > 1000 * 60 * 3; // 间隔时间小于3分钟不显示时间\n        },\n        send(data) {\n            sendLetter(this.contact.sender_info.id, this.contact.receiver_info.id, data).then((res) => {\n                this.loadLetter(false).then((res) => {\n                    this.$refs.sendBox?.clear();\n                    this.$emit(\"update:contact\");\n\n                    clearInterval(this.timer);\n                    this.cycleLoad();\n\n                    this.$nextTick(() => {\n                        // 新消息直接滑到底部\n                        if (this.letterList) {\n                            this.letterList.scrollTop = this.letterList.scrollHeight;\n                        }\n                    });\n                });\n            });\n        },\n    },\n};\n</script>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./list.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../../node_modules/vue-svg-inline-loader/dist/index.min.js!./list.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./list.vue?vue&type=template&id=e1274016\"\nimport script from \"./list.vue?vue&type=script&lang=js\"\nexport * from \"./list.vue?vue&type=script&lang=js\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","<!-- 私信系统 -->\n<template>\n    <uc class=\"m-dashboard-frame m-dashboard-skin\" icon=\"el-icon-bell\" title=\"我的消息\" :tab-list=\"tabList\">\n        <div class=\"m-dashboard-letter\" v-if=\"hasData\">\n            <div class=\"m-dashboard-letter__left\">\n                <div class=\"u-title\">近期消息 <span class=\"u-limit\">每日上限{{ total_limit }}条</span></div>\n                <contact-list\n                    @update:contact=\"updateContact\"\n                    @check:contacts=\"checkContacts\"\n                    ref=\"contacts\"\n                    :can-op=\"canOp\"\n                />\n            </div>\n            <div class=\"m-dashboard-letter__right\">\n                <letter-list :contact=\"contact\" @update:contact=\"letterUpdateContact\" :can-op=\"canOp\" />\n            </div>\n        </div>\n        <div class=\"u-null\" v-else>\n            <el-empty :image=\"emptyPng\" description=\"这里什么都没有呢~\"></el-empty>\n        </div>\n    </uc>\n</template>\n\n<script>\n// data\nimport { msgTab } from \"@/assets/data/tabs.json\";\n// utils\nimport { cloneDeep } from \"lodash\";\nimport { getMyInfo } from \"@/service/index.js\";\n// components\nimport uc from \"@/components/uc.vue\";\nimport contactList from \"@/components/letter/contacts.vue\";\nimport letterList from \"@/components/letter/list.vue\";\nimport User from \"@jx3box/jx3box-common/js/user\";\nimport { getConfig } from \"@/service/letter\";\nexport default {\n    name: \"letter\",\n    components: {\n        uc,\n        contactList,\n        letterList,\n    },\n    data() {\n        return {\n            tabList: msgTab,\n            hasData: true,\n            info: {\n                uid: 8,\n                name: \"匿名\",\n                user_avatar: \"https://img.jx3box.com/image/common/avatar.png\",\n                user_avatar_frame: \"default\",\n                bio: \"-\",\n                sign: 0,\n                experience: 0,\n            },\n\n            contact: {},\n            total_limit: 0,\n        };\n    },\n    computed: {\n        emptyPng() {\n            return require(\"@/assets/img/null.png\");\n        },\n        userLevel() {\n            return User.getLevel(this.info?.experience || 0);\n        },\n        canOp() {\n            return this.userLevel >= 3;\n        },\n    },\n    mounted() {\n        this.loadUserInfo();\n        this.loadConf();\n    },\n    methods: {\n        // 更新联系人\n        updateContact(item) {\n            this.contact = cloneDeep(item);\n        },\n        checkContacts(hasData) {\n            this.hasData = hasData;\n        },\n        letterUpdateContact() {\n            this.$refs.contacts?.getContacts();\n        },\n\n        loadUserInfo: function () {\n            getMyInfo().then((res) => {\n                if (res.data.data) {\n                    this.info = res.data.data;\n                }\n            });\n        },\n        loadConf() {\n            getConfig({ key: \"private_letter_everyday_count_limit\" }).then((res) => {\n                this.total_limit = ~~res.data.data.val;\n            });\n        },\n    },\n};\n</script>\n\n<style lang=\"less\">\n@import \"~@/assets/css/letter.less\";\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./letter.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./letter.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./letter.vue?vue&type=template&id=6c656028\"\nimport script from \"./letter.vue?vue&type=script&lang=js\"\nexport * from \"./letter.vue?vue&type=script&lang=js\"\nimport style0 from \"./letter.vue?vue&type=style&index=0&id=6c656028&prod&lang=less\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./letter.vue?vue&type=style&index=0&id=6c656028&prod&lang=less\"","module.exports = __webpack_public_path__ + \"img/null.aec24a0e.png\";"],"sourceRoot":""}
(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-7f6e224e"],{"826f":function(t,s,i){"use strict";i.r(s);var n=function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"m-dashboard m-dashboard-work m-dashboard-whitelist"},[i("div",{staticClass:"m-dashboard-whitelist-cont"},[i("h2",{staticClass:"u-title"},[t._m(0),t.isDrag?i("span",{staticClass:"u-sort u-drag",on:{click:t.exitDrag}},[i("i",{staticClass:"el-icon-finished"}),t._v(" 退出排序 ")]):i("span",{staticClass:"u-sort",on:{click:function(s){t.isDrag=!0}}},[i("i",{staticClass:"el-icon-sort"}),t._v(" 排序 ")])]),i("el-alert",{directives:[{name:"show",rawName:"v-show",value:t.success,expression:"success"}],attrs:{title:t.onSuccess,type:"success",center:"","show-icon":""}}),t.isDrag?i("draggable",t._b({staticClass:"m-drag",attrs:{element:"div",list:t.list},on:{start:t.dragStart}},"draggable",{animation:150,scrollSensitivity:200},!1),[i("transition-group",{attrs:{type:"transition"}},t._l(t.list,(function(s){return i("div",{key:s.id,staticClass:"u-item"},[i("div",{staticClass:"u-item-box"},[i("img",{attrs:{src:t._f("showAvatar")(s.kith_info.user_avatar)}}),i("div",{staticClass:"u-txt"},[t._v(t._s(s.remark||s.kith_info.display_name))])])])})),0)],1):i("div",{staticClass:"u-box"},t._l(t.list,(function(s,n){return i("div",{key:n,staticClass:"u-item"},[i("div",{staticClass:"u-item-box"},[i("img",{attrs:{src:t._f("showAvatar")(s.kith_info.user_avatar)}}),i("div",{staticClass:"u-item-txt"},[i("div",{staticClass:"u-item-name"},[i("span",[t._v(t._s(s.kith_info.display_name))]),i("span",[t._v("备注："+t._s(s.remark||"无"))])]),i("div",{staticClass:"u-item-btn"},[i("el-button",{attrs:{type:"warning"},on:{click:function(i){return t.delWhitelistBtn(s.kith_id)}}},[t._v("删除")]),i("el-button",{on:{click:function(i){return t.editWhitelistBtn(s.kith_id)}}},[t._v("编辑")])],1)])])])})),0)],1),i("div",{staticClass:"m-dashboard-whitelist-add"},[t._m(1),i("el-input",{staticClass:"u-input",attrs:{placeholder:"输入UID添加",disabled:t.isDrag,"suffix-icon":"el-icon-search"},on:{input:t.searchUid},model:{value:t.uid,callback:function(s){t.uid=s},expression:"uid"}}),t.hasUser?i("div",{staticClass:"u-box u-user"},[i("img",{attrs:{src:t._f("showAvatar")(t.userInfo.user_avatar),alt:"userInfo.display_name"}}),i("div",{staticClass:"u-txt"},[i("span",[t._v("UID："+t._s(t.userInfo.ID))]),i("span",[t._v(t._s(t.userInfo.display_name))])])]):i("div",{staticClass:"u-box"},[i("el-alert",{attrs:{title:"请输入UID",type:"info","show-icon":"",closable:!1}})],1),i("el-button",{attrs:{type:"success",disabled:!t.allowAppend},on:{click:function(s){return t.addWhitelistBtn(t.userInfo)}}},[t._v("添加亲友 ("+t._s(t.list.length)+" / "+t._s(t.hasNum)+")")])],1)])},e=[function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("span",{staticClass:"i-title"},[i("i",{staticClass:"el-icon-copy-document"}),t._v(" 我的亲友 ")])},function(){var t=this,s=t.$createElement,i=t._self._c||s;return i("div",{staticClass:"u-title"},[i("i",{staticClass:"el-icon-news"}),t._v(" 添加亲友")])}],a=(i("a434"),i("41cb"));function r(){return Object(a["b"])({proxy:!0}).get("/api/cms/user/kith/my")}function c(t){return Object(a["b"])({proxy:!0}).get("/api/cms/user/".concat(t,"/info"))}function o(t){return Object(a["b"])({proxy:!0}).delete("/api/cms/user/kith/".concat(t))}function u(t){return Object(a["b"])({proxy:!0}).post("/api/cms/user/kith/".concat(t))}function l(t){return Object(a["b"])({proxy:!0}).put("/api/cms/user/kith",t)}function h(t,s){return Object(a["b"])({proxy:!0}).put("/api/cms/user/kith/".concat(t),s)}var d=i("c9d2"),f=i("b76a"),v=i.n(f),p=i("85e4"),m={name:"whitelist",props:[],data:function(){return{uid:"",list:{},userInfo:"",onSuccess:"",isvip:!1,ispro:!1,isDrag:!1,dragList:!1}},computed:{isVerify:function(){return""!=this.uid&&null!=this.userInfo},hasUser:function(){return this.userInfo},success:function(){return""!==this.onSuccess},allowAppend:function(){var t=this.list.length;return 0==this.isDrag&&(t<5||(t<20?this.isvip:t<100&&this.ispro))},hasNum:function(){return this.ispro?100:this.isvip?20:5}},methods:{dragStart:function(){this.dragList=!0},exitDrag:function(){var t=this;if(this.isDrag=!1,1==this.dragList){for(var s=this.list,i=[],n=0;n<s.length;n++)s[n].level=s.length-n,i.push({level:s[n].level,kith_id:s[n].kith_id});l(i).then((function(){t.$notify({title:"成功",message:"调整排序成功!",type:"success"}),t.dragList=!1}))}},searchUid:function(){var t=this;this.uid&&c(this.uid).then((function(s){t.userInfo=s.data.data}))},addWhitelistBtn:function(t){var s=this,i={kith_id:t.ID,kith_info:{display_name:t.display_name,user_avatar:t.user_avatar},level:this.list.length};u(this.uid).then((function(t){s.successTxt("亲友添加成功"),s.list.unshift(i)}))},delWhitelistBtn:function(t){var s=this,i=this.list;this.$confirm("是否继续删除该亲友?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then((function(){o(t).then((function(){s.$notify({title:"成功",message:"删除成功!",type:"success"});for(var n=0;n<i.length;n++)i[n].kith_id==t&&i.splice(n,1);s.list=i}))})).catch((function(){}))},editWhitelistBtn:function(t){var s=this;this.$prompt("请输入备注","提示",{confirmButtonText:"确定",cancelButtonText:"取消"}).then((function(i){h(t,{remark:i.value}).then((function(){s.successTxt("备注添加成功");for(var n=0;n<s.list.length;n++)s.list[n].kith_id==t&&(s.list[n].remark=i.value)}))})).catch((function(){}))},successTxt:function(t){var s=this;this.onSuccess=t,this.uid="",this.userInfo="",setTimeout((function(){s.onSuccess=""}),2e3)},getList:function(){var t=this;r().then((function(s){for(var i=s.data.data,n=i.length-1;n>0;n--)for(var e=i.length-1-n;e>0;e--)if(i[e].level>i[e-1].level){var a=i[e];i[e]=i[e-1],i[e-1]=a}t.list=i}))}},mounted:function(){var t=this;this.getList(),d["a"].getAsset().then((function(){d["a"].isVIP().then((function(s){t.isvip=s})),d["a"].isPRO().then((function(s){t.ispro=s}))}))},filters:{showAvatar:function(t){return Object(p["showAvatar"])(t,80)}},components:{draggable:v.a}},_=m,g=(i("f92a"),i("2877")),b=Object(g["a"])(_,n,e,!1,null,"058a7ad9",null);s["default"]=b.exports},c829:function(t,s,i){},f92a:function(t,s,i){"use strict";i("c829")}}]);
//# sourceMappingURL=chunk-7f6e224e.5583e7f0.js.map
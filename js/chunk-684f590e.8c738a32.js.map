{"version":3,"sources":["webpack:///./src/views/avatar.vue?4449","webpack:///./src/views/avatar.vue","webpack:///src/views/avatar.vue","webpack:///./src/views/avatar.vue?2726","webpack:///./src/views/avatar.vue?e971","webpack:///./src/service/profile.js"],"names":["render","_vm","this","_c","_self","staticClass","attrs","showAvatar","avatar","upload","_v","avatarList","length","_l","item","i","key","on","$event","changeAvatar","concat","imgPath","_e","submit","reset","staticRenderFns","name","props","data","bak","frame","isVIP","uid","User","getInfo","frames","tabActivate","decorationJson","decoration","decorationActivate","originalActivateName","selectAll","noDecoration","__imgPath","computed","user_avatar","methods","file","fileList","_this","formdata","FormData","filedata","raw","append","uploadAvatar","then","res","$message","message","type","_this2","updateAvatar","refresh","showFrame","init","_this3","avatar_origin","getUserOverview","user_avatar_frame","loadAvatar","_this4","getBreadcrumb","split","link","val","showSmallAvatar","created","components","uc","component","getProfile","$cms","get","updateProfile","put","post","getFrames","url","axios","params","__no_cache","updatePassword","checkEmailAvailable","email","sendBindEmail","sendVerifyEmail","code","app","checkOAuth","unbindOAuth","popType","delete","getWechatQrcode","unbindWechat","sendPhoneCode","verifyPhone","checkPhone"],"mappings":"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","file":"js/chunk-684f590e.8c738a32.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--11-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--11-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--11-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--11-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--11-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./avatar.vue?vue&type=style&index=0&id=59d7eaf5&prod&lang=less\"","var render = function render(){var _vm=this,_c=_vm._self._c;return _c('uc',{staticClass:\"m-dashboard-avatar\"},[_c('div',{staticClass:\"m-profile-avatar\"},[_c('div',{staticClass:\"m-profile-box m-profile-avatar-primary\"},[_c('img',{staticClass:\"u-avatar u-avatar-l\",attrs:{\"src\":_vm.showAvatar(_vm.avatar)}}),_c('el-upload',{staticClass:\"u-upload\",attrs:{\"drag\":\"\",\"accept\":\"image/png, image/gif, image/jpeg\",\"on-change\":_vm.upload,\"action\":\"upload/avatar\",\"auto-upload\":false}},[_c('i',{staticClass:\"el-icon-upload\"}),_c('div',{staticClass:\"el-upload__text\"},[_vm._v(\" 将文件拖到此处，或 \"),_c('em',[_vm._v(\"点击上传\")]),_c('br'),_c('span',{staticClass:\"u-tip\"},[_vm._v(\"只能上传jpg/png/gif文件\")])])])],1),_c('div',{staticClass:\"m-profile-box m-profile-avatar-list\"},[_c('div',{staticClass:\"u-title\"},[_vm._v(\"默认头像\")]),(_vm.avatarList.length)?_vm._l((_vm.avatarList),function(item,i){return _c('span',{key:i,staticClass:\"u-avatar\",on:{\"click\":function($event){return _vm.changeAvatar(`${_vm.imgPath}img/avatar/${item}.jpg`)}}},[_c('el-avatar',{attrs:{\"shape\":\"square\",\"size\":86,\"src\":`${_vm.imgPath}img/avatar/${item}.jpg`}})],1)}):_vm._e()],2)]),_c('div',{staticClass:\"u-profile-btn\"},[_c('el-button',{attrs:{\"type\":\"primary\"},on:{\"click\":_vm.submit}},[_vm._v(\"确认\")]),_c('el-button',{on:{\"click\":_vm.reset}},[_vm._v(\"重置\")])],1)])\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n    <uc class=\"m-dashboard-avatar\">\n        <div class=\"m-profile-avatar\">\n            <div class=\"m-profile-box m-profile-avatar-primary\">\n                <img class=\"u-avatar u-avatar-l\" :src=\"showAvatar(avatar)\" /> \n                <el-upload\n                    class=\"u-upload\"\n                    drag\n                    accept=\"image/png, image/gif, image/jpeg\"\n                    :on-change=\"upload\"\n                    action=\"upload/avatar\"\n                    :auto-upload=\"false\"\n                >\n                    <i class=\"el-icon-upload\"></i>\n                    <div class=\"el-upload__text\">\n                        将文件拖到此处，或\n                        <em>点击上传</em>\n                        <br />\n                        <span class=\"u-tip\">只能上传jpg/png/gif文件</span>\n                    </div>\n                </el-upload>\n            </div>\n            <div class=\"m-profile-box m-profile-avatar-list\">\n                <div class=\"u-title\">默认头像</div>\n                <template v-if=\"avatarList.length\">\n                    <span\n                        class=\"u-avatar\"\n                        v-for=\"(item, i) in avatarList\"\n                        :key=\"i\"\n                        @click=\"changeAvatar(`${imgPath}img/avatar/${item}.jpg`)\"\n                    >\n                        <el-avatar shape=\"square\" :size=\"86\" :src=\"`${imgPath}img/avatar/${item}.jpg`\"></el-avatar>\n                    </span>\n                </template>\n            </div>\n        </div>\n        <div class=\"u-profile-btn\">\n            <el-button type=\"primary\" @click=\"submit\">确认</el-button>\n            <el-button @click=\"reset\">重置</el-button>\n        </div>\n    </uc>\n</template>\n\n<script>\nimport uc from \"@/components/uc.vue\";\nimport { getBreadcrumb } from \"@jx3box/jx3box-common/js/api_misc.js\";\nimport { updateAvatar, uploadAvatar, getUserOverview } from \"@/service/profile\";\nimport User from \"@jx3box/jx3box-common/js/user\";\nimport { showAvatar } from \"@jx3box/jx3box-common/js/utils\";\nimport frames from \"@jx3box/jx3box-common/data/user_avatar_frame.json\";\nimport { __imgPath } from \"@jx3box/jx3box-common/data/jx3box.json\";\nexport default {\n    name: \"avatar\",\n    props: [],\n    data: function () {\n        return {\n            // 备份\n            bak: \"\",\n            // 数据\n            avatar: \"\",\n            frame: \"\",\n            // VIP\n            isVIP: false,\n            uid: User.getInfo().uid,\n            // 头像框\n            frames,\n            tabActivate: \"0\",\n            decorationJson: {},\n            decoration: [],\n            decorationActivate: null,\n            originalActivateName: null,\n            selectAll: [],\n            noDecoration: false,\n\n            avatarList: [],\n            imgPath: __imgPath,\n        };\n    },\n    computed: {\n        data: function () {\n            return {\n                user_avatar: this.avatar,\n            };\n        },\n    },\n    methods: {\n        upload: function (file, fileList) {\n            let formdata = new FormData();\n            let filedata = file.raw;\n            formdata.append(\"avatar\", filedata);\n            uploadAvatar(formdata).then((res) => {\n                this.$message({\n                    message: \"上传成功\",\n                    type: \"success\",\n                });\n                this.avatar = res.data.data[0];\n            });\n        },\n        reset: function () {\n            this.avatar = this.bak;\n        },\n        submit: function () {\n            // this.decorationSubmit();\n            // if (!this.isVIP) {\n            //     if (this.frame) {\n            //         this.$notify({\n            //             title: \"头像框未生效\",\n            //             message: \"头像框仅高级/专业账号可用\",\n            //             type: \"warning\",\n            //         });\n            //     }\n            //     this.frame = \"\";\n            // }\n            updateAvatar(this.data).then((res) => {\n                User.refresh(\"avatar\", this.avatar);\n                this.$message({\n                    message: \"头像更新成功\",\n                    type: \"success\",\n                });\n            });\n        },\n        showFrame: function (name) {\n            // if (process.env.NODE_ENV == \"development\") {\n            //     return `temp/avatar/${name}/${name}.svg`;\n            // }\n            return __imgPath + `avatar/images/${name}/${name}.svg`;\n        },\n        init: function () {\n            this.avatar = this.bak = User.getInfo().avatar_origin;\n            getUserOverview(this.uid).then((res) => {\n                this.frame = res.data.data.user_avatar_frame || \"\";\n            });\n            this.loadAvatar();\n        },\n        loadAvatar() {\n            getBreadcrumb(\"dashboard-default-avatar\").then((res) => {\n                this.avatarList = res ? res.split(\",\") : [];\n            });\n        },\n        changeAvatar(link) {\n            this.avatar = link;\n        },\n        showAvatar: function (val) {\n            return showAvatar(val, 480, false);\n        },\n        showSmallAvatar: function (val) {\n            return showAvatar(val, 136, false);\n        },\n    },\n    created: function () {\n        this.init();\n    },\n    components: {\n        uc,\n    },\n};\n</script>\n\n<style lang=\"less\">\n@import \"../assets/css/profile/avatar.less\";\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./avatar.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./avatar.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./avatar.vue?vue&type=template&id=59d7eaf5\"\nimport script from \"./avatar.vue?vue&type=script&lang=js\"\nexport * from \"./avatar.vue?vue&type=script&lang=js\"\nimport style0 from \"./avatar.vue?vue&type=style&index=0&id=59d7eaf5&prod&lang=less\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\nexport default component.exports","import { $cms, $_https } from \"@jx3box/jx3box-common/js/https.js\";\n\nimport axios from \"axios\";\nimport { __imgPath } from \"@jx3box/jx3box-common/data/jx3box.json\";\n\n// 1.资料\n// -------------------------------\nfunction getProfile() {\n    return $cms().get(\"/api/cms/user/my/profile\");\n}\nfunction updateProfile(data) {\n    return $cms().put(\"/api/cms/user/my/profile\", data);\n}\n\n// 2.头像\n// -------------------------------\nfunction updateAvatar(data) {\n    return $cms().put(\"/api/cms/user/my/avatar\", data);\n}\nfunction uploadAvatar(data) {\n    return $cms().post(\"/api/cms/upload/avatar\", data);\n}\nfunction getFrames() {\n    // let url = process.env.NODE_ENV == 'development'?'/temp/user_avatar_frame.json':(__imgPath + \"avatar/index.json\")\n    let url = __imgPath + \"avatar/index.json\";\n    return axios.get(url);\n}\nfunction getUserOverview(uid) {\n    return $cms().get(`/api/cms/user/${uid}/info`, {\n        params: {\n            __no_cache: 1,\n        },\n    });\n}\n\n// 3.密码\n// -------------------------------\n// 发送验证码\nfunction sendVerifyCode(data) {\n    return $cms().post(\"/api/cms/user/account/email/forgot-password\", data, {\n        app: \"jx3box\",\n    });\n}\n// 重设密码\nfunction updatePassword(data) {\n    return $cms().put(\"/api/cms/user/my/password\", data);\n}\n\n// 4.邮箱\n// -------------------------------\nfunction checkEmailAvailable(email) {\n    return $cms().get(\"/api/cms/user/account/email/valid\", {\n        params: {\n            email\n        }\n    });\n}\n\nfunction sendBindEmail(data) {\n    return $cms().post(\"/api/cms/user/account/email/bind\", data);\n}\n\nfunction sendVerifyEmail(code) {\n    return $cms().put(\"/api/cms/user/account/email/verify\", {\n        code,\n    }, { app: 'jx3box' });\n}\n\n// 5.互联\nfunction checkOAuth() {\n    return $cms().get(\"/api/cms/account/oauth/status\");\n}\n\nfunction unbindOAuth(type) {\n    return $cms({\n        popType: \"alert\",\n    }).delete(`/api/cms/account/oauth/unbind/${type}`);\n}\n\n// 6.微信\n// 获取微信二维码\nfunction getWechatQrcode() {\n    return $cms().get(`/api/cms/wechat/mp/bind`);\n}\n\n// 解除绑定\nfunction unbindWechat() {\n    return $cms().get(`/api/cms/wechat/mp/unbind`);\n}\n\n// 7.手机\n// -------------------------------\nfunction sendPhoneCode(data) {\n    return $cms().post(\"/api/cms/account/oauth/phone/bind\", data, {\n        app: \"jx3box\",\n    });\n}\n\nfunction verifyPhone(data) {\n    return $cms().put(\"/api/cms/account/oauth/phone/verify\", data, {\n        app: \"jx3box\",\n    });\n}\n\nfunction checkPhone(params) {\n    return $cms().get(\"/api/cms/account/oauth/phone/check\", {\n        params,\n    });\n}\n\nexport {\n    updateProfile,\n    getProfile,\n    updateAvatar,\n    updatePassword,\n    sendVerifyEmail,\n    checkEmailAvailable,\n    sendBindEmail,\n    unbindOAuth,\n    checkOAuth,\n    uploadAvatar,\n    getFrames,\n    getUserOverview,\n    getWechatQrcode,\n    unbindWechat,\n    sendVerifyCode,\n\n    sendPhoneCode,\n    verifyPhone,\n    checkPhone,\n};\n"],"sourceRoot":""}
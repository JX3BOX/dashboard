{"version":3,"sources":["webpack:///./src/views/msg.vue?a6ac","webpack:///./src/views/msg.vue?b157","webpack:///./src/service/msg.js","webpack:///src/views/msg.vue","webpack:///./src/views/msg.vue?28b0","webpack:///./src/views/msg.vue"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","_v","attrs","unread_total","on","$event","read","domProps","_s","data","_l","item","i","directives","name","rawName","value","deleted","expression","key","class","content","source_id","source_type","_f","_e","dateFormat","created","del","page","total","changePage","staticRenderFns","getMsgs","$http","get","params","readMsg","ids","put","qs","stringify","removeMsg","component"],"mappings":"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","file":"js/chunk-cfdd188a.3a4d1ded.js","sourcesContent":["export * from \"-!../../node_modules/mini-css-extract-plugin/dist/loader.js??ref--10-oneOf-1-0!../../node_modules/css-loader/dist/cjs.js??ref--10-oneOf-1-1!../../node_modules/vue-loader/lib/loaders/stylePostLoader.js!../../node_modules/postcss-loader/src/index.js??ref--10-oneOf-1-2!../../node_modules/less-loader/dist/cjs.js??ref--10-oneOf-1-3!../../node_modules/style-resources-loader/lib/index.js??ref--10-oneOf-1-4!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./msg.vue?vue&type=style&index=0&id=a040db1c&scoped=true&lang=less&\"","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"m-dashboard m-dashboard-work m-dashboard-msg\"},[_c('div',{staticClass:\"m-dashboard-msg-header\"},[_c('h2',{staticClass:\"u-title\"},[_vm._v(\" 我的消息 \")]),_c('el-button',{staticClass:\"u-read-all\",attrs:{\"type\":\"primary\",\"size\":\"mini\",\"disabled\":!_vm.unread_total},on:{\"click\":function($event){return _vm.read(null)}}},[_c('i',{staticClass:\"el-icon el-icon-check\"}),_c('span',{domProps:{\"textContent\":_vm._s('全部设为已读')}})])],1),(_vm.data.length)?_c('ul',{staticClass:\"m-dashboard-box-list\"},_vm._l((_vm.data),function(item,i){return _c('li',{directives:[{name:\"show\",rawName:\"v-show\",value:(item.deleted == 0),expression:\"item.deleted == 0\"}],key:i,class:{ on: item.read == 1 }},[_c('div',{staticClass:\"u-primary\"},[_c('span',{staticClass:\"u-content\"},[(item.read == 1)?_c('span',{staticClass:\"u-label u-hasChecked\"},[_vm._v(\"已读\")]):_c('span',{staticClass:\"u-label u-hasNotChecked\"},[_vm._v(\"未读\")]),_c('span',{domProps:{\"innerHTML\":_vm._s(item.content)}}),(item.source_id && item.source_type)?_c('a',{staticClass:\"u-msg-link\",attrs:{\"href\":_vm._f(\"msgLink\")(item),\"target\":\"_blank\"},on:{\"click\":function($event){return _vm.read(item)}}},[_c('i',{staticClass:\"el-icon-link\"}),_vm._v(\" 点击查看\")]):_vm._e()]),_c('time',{staticClass:\"u-time\"},[_c('i',{staticClass:\"el-icon-phone-outline\"}),_vm._v(\" \"+_vm._s(_vm.dateFormat(~~item.created)))])]),_c('el-button-group',{staticClass:\"u-action\"},[_c('el-button',{attrs:{\"size\":\"mini\",\"icon\":\"el-icon-check\",\"title\":\"设为已读\",\"disabled\":item.read == 1},on:{\"click\":function($event){return _vm.read(item)}}}),_c('el-button',{attrs:{\"size\":\"mini\",\"icon\":\"el-icon-delete\",\"title\":\"删除\"},on:{\"click\":function($event){return _vm.del(item)}}})],1)],1)}),0):_c('el-alert',{staticClass:\"m-dashboard-box-null\",attrs:{\"title\":\"没有找到相关条目\",\"type\":\"info\",\"center\":\"\",\"show-icon\":\"\"}}),_c('el-pagination',{staticClass:\"m-dashboard-box-pages\",attrs:{\"background\":\"\",\"hide-on-single-page\":true,\"current-page\":_vm.page,\"layout\":\"total, prev, pager, next, jumper\",\"total\":_vm.total},on:{\"current-change\":_vm.changePage}})],1)}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","import { $http } from \"./axios\";\nimport qs from \"qs\";\n\nfunction getMsgs(i = 1) {\n    return $http.get(\"/api/messages\", {\n        params: {\n            // length : 2,\n            page: i,\n        },\n    });\n}\n\nfunction readMsg(ids) {\n    let data = {};\n    if (ids) data.ids = ids;\n\n    return $http.put(`/api/messages/read`, qs.stringify(data));\n}\n\nfunction removeMsg(ids) {\n    return $http.put(\n        `/api/messages/remove`,\n        qs.stringify({\n            ids: ids,\n        })\n    );\n}\n\nexport { getMsgs, readMsg, removeMsg };\n","<template>\n    <div class=\"m-dashboard m-dashboard-work m-dashboard-msg\">\n        <div class=\"m-dashboard-msg-header\">\n            <h2 class=\"u-title\">\n                我的消息\n            </h2>\n            <el-button\n                class=\"u-read-all\"\n                type=\"primary\"\n                size=\"mini\"\n                @click=\"read(null)\"\n                :disabled=\"!unread_total\"\n            >\n                <i class=\"el-icon el-icon-check\"></i>\n                <span v-text=\"'全部设为已读'\"></span>\n            </el-button>\n        </div>\n        <ul class=\"m-dashboard-box-list\" v-if=\"data.length\">\n            <li\n                v-for=\"(item, i) in data\"\n                :key=\"i\"\n                :class=\"{ on: item.read == 1 }\"\n                v-show=\"item.deleted == 0\"\n            >\n                <div class=\"u-primary\">\n                    <span class=\"u-content\">\n                        <span class=\"u-label u-hasChecked\" v-if=\"item.read == 1\"\n                            >已读</span\n                        >\n                        <span class=\"u-label u-hasNotChecked\" v-else>未读</span>\n                        <span v-html=\"item.content\"></span>\n                        <a\n                            :href=\"item | msgLink\"\n                            class=\"u-msg-link\"\n                            v-if=\"item.source_id && item.source_type\"\n                            @click=\"read(item)\"\n                            target=\"_blank\"\n                            ><i class=\"el-icon-link\"></i> 点击查看</a\n                        >\n                    </span>\n                    <time class=\"u-time\"\n                        ><i class=\"el-icon-phone-outline\"></i>\n                        {{ dateFormat(~~item.created) }}</time\n                    >\n                </div>\n                <el-button-group class=\"u-action\">\n                    <el-button\n                        size=\"mini\"\n                        icon=\"el-icon-check\"\n                        title=\"设为已读\"\n                        @click=\"read(item)\"\n                        :disabled=\"item.read == 1\"\n                    ></el-button>\n                    <el-button\n                        size=\"mini\"\n                        icon=\"el-icon-delete\"\n                        title=\"删除\"\n                        @click=\"del(item)\"\n                    ></el-button>\n                </el-button-group>\n            </li>\n        </ul>\n        <el-alert\n            v-else\n            class=\"m-dashboard-box-null\"\n            title=\"没有找到相关条目\"\n            type=\"info\"\n            center\n            show-icon\n        >\n        </el-alert>\n        <el-pagination\n            class=\"m-dashboard-box-pages\"\n            background\n            :hide-on-single-page=\"true\"\n            @current-change=\"changePage\"\n            :current-page=\"page\"\n            layout=\"total, prev, pager, next, jumper\"\n            :total=\"total\"\n        >\n        </el-pagination>\n    </div>\n</template>\n\n<script>\nimport { getMsgs, readMsg, removeMsg } from \"../service/msg.js\";\nimport { showDate, showTime } from \"@jx3box/jx3box-common/js/moment.js\";\nimport { getLink } from \"@jx3box/jx3box-common/js/utils\";\nexport default {\n    name: \"msg\",\n    props: [],\n    data: function() {\n        return {\n            type: \"all\",\n            data: [],\n            unread_total: 0,\n            total: 1,\n            page: 1,\n        };\n    },\n    methods: {\n        changePage: function(i = 1) {\n            this.page = i;\n            getMsgs(i).then((res) => {\n                this.unread_total = res.data.data.unread_count;\n                this.total = res.data.data.total;\n                this.data = res.data.data.messages;\n            });\n        },\n        read(item) {\n            readMsg(item ? [item.ID] : null).then((res) => {\n                if (res.data.code === 200) {\n                    if (item) {\n                        item.read = 1;\n                    } else {\n                        this.changePage(this.page);\n                    }\n                } else {\n                    this.$notify.error({ title: res.data.message });\n                }\n            });\n        },\n        del(item) {\n            removeMsg([item.ID]).then((res) => {\n                if (res.data.code === 200) {\n                    item.deleted = Math.round(new Date() / 1000);\n                } else {\n                    this.$notify.error({ title: res.data.message });\n                }\n            });\n        },\n        dateFormat: function(val) {\n            return showTime(new Date(val * 1000));\n        },\n    },\n    filters: {\n        msgLink: function(item) {\n            let id = item.source_id;\n            let type = item.source_type;\n            return getLink(type, id);\n        },\n    },\n    mounted: function() {\n        this.changePage();\n    },\n};\n</script>\n\n<style scoped lang=\"less\">\n@import \"../assets/css/msg.less\";\n</style>\n","import mod from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./msg.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../node_modules/cache-loader/dist/cjs.js??ref--12-0!../../node_modules/thread-loader/dist/cjs.js!../../node_modules/babel-loader/lib/index.js!../../node_modules/cache-loader/dist/cjs.js??ref--0-0!../../node_modules/vue-loader/lib/index.js??vue-loader-options!../../node_modules/vue-svg-inline-loader/dist/index.min.js!./msg.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./msg.vue?vue&type=template&id=a040db1c&scoped=true&\"\nimport script from \"./msg.vue?vue&type=script&lang=js&\"\nexport * from \"./msg.vue?vue&type=script&lang=js&\"\nimport style0 from \"./msg.vue?vue&type=style&index=0&id=a040db1c&scoped=true&lang=less&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"a040db1c\",\n  null\n  \n)\n\nexport default component.exports"],"sourceRoot":""}